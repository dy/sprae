<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title | default: "Sprae" }} â€“ reactive sprinkles</title>
    <meta name="description" content="{{ page.description | default: 'Sprae is a tiny (~5KB) reactive library for progressive enhancement using signal-powered attributes in HTML/JSX.' }}">
    <link rel="stylesheet" href="{{ '/assets/style.css' | relative_url }}" />
    <script type="module">
      import sprae, { use } from 'https://cdn.jsdelivr.net/npm/sprae/+esm'
      use({ prefix: 'data-' })
      sprae(document.body)
    </script>
  </head>

  <body>
    <!-- Spray effect - cursor cloud with inertia -->
    <div id="spray" data-scope="{
      clouds: [],
      mx: 0, my: 0,
      cx: 0, cy: 0,
      cvx: 0, cvy: 0,
      pressed: false,
      mouseEntered: false,
      activeIdx: -1,
      MAX: 30,
      cursorSize: 30,
      cursorIntensity: 0.15,

      init() {
        this.cx = innerWidth / 2
        this.cy = innerHeight / 2
        const loop = () => {
          this.update()
          requestAnimationFrame(loop)
        }
        loop()
      },

      press(e) {
        this.mx = e.pageX; this.my = e.pageY
        this.pressed = true
        if (this.clouds.length >= this.MAX) {
          this.clouds.shift()
          if (this.activeIdx >= 0) this.activeIdx--
        }
        this.clouds.push({
          id: Date.now(),
          x: this.cx, y: this.cy,
          vx: this.cvx, vy: this.cvy,
          size: this.cursorSize,
          intensity: 0,
          released: false,
          age: 0
        })
        this.activeIdx = this.clouds.length - 1
      },

      release() {
        this.pressed = false
        if (this.activeIdx >= 0 && this.clouds[this.activeIdx]) {
          const c = this.clouds[this.activeIdx]
          c.released = true
          c.vx = this.cvx
          c.vy = this.cvy
          c.age = 0
          this.activeIdx = -1
        }
        this.cursorSize = 30
        this.cursorIntensity = 0.15
      },

      move(e) {
        if (!this.mouseEntered) {
          this.mouseEntered = true
          this.cx = e.pageX
          this.cy = e.pageY
        }
        this.mx = e.pageX
        this.my = e.pageY
      },

      update() {
        const pageH = Math.max(document.body.scrollHeight, document.documentElement.scrollHeight)

        // Cursor follows mouse with inertia
        const dx = this.mx - this.cx
        const dy = this.my - this.cy
        this.cvx += dx * 0.08
        this.cvy += dy * 0.08
        this.cvx *= 0.85
        this.cvy *= 0.85
        this.cx += this.cvx
        this.cy += this.cvy

        // While pressed, grow cursor cloud
        if (this.pressed) {
          this.cursorSize += 0.4
          this.cursorIntensity = Math.min(1, this.cursorIntensity + 0.06)
        }

        // Update active cloud to follow cursor
        if (this.activeIdx >= 0 && this.clouds[this.activeIdx]) {
          const c = this.clouds[this.activeIdx]
          c.x = this.cx
          c.y = this.cy
          c.size = this.cursorSize
          c.intensity = this.cursorIntensity
        }

        // Update released clouds
        for (const c of this.clouds) {
          if (!c.released) continue

          c.age++
          c.vy += 0.015
          c.vx *= 0.99
          c.vy *= 0.995
          c.vx += (Math.random() - 0.5) * 0.02
          c.x += c.vx
          c.y += c.vy

          // Keep growing but don't increase intensity
          c.size += 0.4 / (1 + c.age * 0.008)

          // Very slow intensity fade
          c.intensity = Math.max(0.05, c.intensity * 0.9995)

          // Settle at bottom
          if (c.y > pageH - c.size * 0.3) {
            c.y = pageH - c.size * 0.3
            c.vy = 0
            c.vx *= 0.95
          }

          // Bounce sides
          if (c.x < c.size * 0.3) { c.x = c.size * 0.3; c.vx *= -0.3 }
          if (c.x > innerWidth - c.size * 0.3) { c.x = innerWidth - c.size * 0.3; c.vx *= -0.3 }
        }

        this.clouds = [...this.clouds]
        document.getElementById('spray').style.height = pageH + 'px'
      },

      cursorStyle() {
        const blur = this.cursorSize * 0.3
        const i = this.cursorIntensity
        const centerL = 50 - i * 35  // 50% -> 15% (much darker)
        const centerS = 60 + i * 35  // 60% -> 95%
        const alpha = 0.15 + i * 0.7  // 0.15 -> 0.85
        return `
          position: absolute;
          left: ${this.cx}px; top: ${this.cy}px;
          width: ${this.cursorSize * 0.5}px; height: ${this.cursorSize * 0.5}px;
          margin: ${-this.cursorSize * 0.25}px;
          border-radius: 50%;
          background: radial-gradient(circle,
            hsla(250, ${centerS}%, ${centerL}%, ${alpha}) 0%,
            hsla(220, 55%, 50%, ${alpha * 0.5}) 35%,
            hsla(190, 60%, 65%, ${alpha * 0.2}) 60%,
            transparent 100%
          );
          mix-blend-mode: multiply;
          filter: blur(${blur}px);
          pointer-events: none;
        `
      },

      style(c) {
        const blur = c.size * 0.3
        const i = c.intensity
        const centerL = 50 - i * 35
        const centerS = 60 + i * 35
        const alpha = 0.15 + i * 0.7
        return `
          position: absolute;
          left: ${c.x}px; top: ${c.y}px;
          width: ${c.size * 0.5}px; height: ${c.size * 0.5}px;
          margin: ${-c.size * 0.25}px;
          border-radius: 50%;
          background: radial-gradient(circle,
            hsla(250, ${centerS}%, ${centerL}%, ${alpha}) 0%,
            hsla(220, 55%, 50%, ${alpha * 0.5}) 35%,
            hsla(190, 60%, 65%, ${alpha * 0.2}) 60%,
            transparent 100%
          );
          mix-blend-mode: multiply;
          filter: blur(${blur}px);
          pointer-events: none;
        `
      }
    }"
    data-onmousemove.document="move"
    data-onmousedown.document="press"
    data-onmouseup.document="release"
    data-fx.once="init()"
    style="position:absolute;inset:0;z-index:-1;overflow:hidden;pointer-events:none;min-height:100%">
      <div data-if="mouseEntered && !pressed" data-style="cursorStyle()"></div>
      <div data-each="c in clouds" data-if="c.released || activeIdx !== clouds.indexOf(c)" data-style="style(c)"></div>
      <div data-if="pressed && activeIdx >= 0" data-style="style(clouds[activeIdx])"></div>
    </div>

    <div class="top-line"></div>
    <a href="https://github.com/dy/sprae" class="github-corner" aria-label="View on GitHub">
      <svg viewBox="0 0 250 250">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path class="octo-arm" d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor"
          style="transform-origin:130px 106px"></path>
        <path class="octo-body"
          d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
          fill="currentColor"></path>
      </svg>
    </a>

    <main>
      <nav>
        <a href="docs">docs</a>
        <a href="drops">drops</a>
      </nav>

      {{ content }}
    </main>
  </body>

</html>
