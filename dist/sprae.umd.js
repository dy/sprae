(function (g, f) {if ("object" == typeof exports && "object" == typeof module) {module.exports = f();} else if ("function" == typeof define && define.amd) {define("sprae", [], f);} else if ("object" == typeof exports) {exports["sprae"] = f();} else {g["sprae"] = f();}}(typeof self !== 'undefined' ? self : typeof globalThis !== 'undefined' ? globalThis : this, () => {var exports = {};var module = { exports };
var re=Object.defineProperty;var Ye=Object.getOwnPropertyDescriptor;var et=Object.getOwnPropertyNames;var tt=Object.prototype.hasOwnProperty;var f=(e,r)=>()=>(e&&(r=e(e=0)),r);var pe=(e,r)=>{for(var t in r)re(e,t,{get:r[t],enumerable:!0})},rt=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of et(r))!tt.call(e,s)&&s!==t&&re(e,s,{get:()=>r[s],enumerable:!(o=Ye(r,s))||o.enumerable});return e};var ot=e=>rt(re({},"__esModule",{value:!0}),e);var z,u,G,J,Q,B,g,T,F,v,D,M,H,oe,st,fe,me,C,de,U,w,m,he,A,se,W,ye,p,h=f(()=>{Y();Y();z=Symbol.dispose||(Symbol.dispose=Symbol("dispose")),u=Symbol("state"),G=Symbol("on"),J=Symbol("off"),Q=Symbol("init"),B=":",v=e=>e(),D=v,M={},H={},oe=null,st=(e=document.body,r)=>{if(e[u])return Object.assign(e[u],r);r=q(r||{});let t=[],o=[];e[G]=()=>!o&&(o=t.map(i=>i())),e[J]=()=>(o?.map(i=>i()),o=null),e[z]||(e[z]=()=>(e[J](),e[J]=e[G]=e[z]=e[Q]=e[u]=null));let s=e[Q]=i=>{let n=i.attributes,a;if(n)for(let l=0;l<n.length;){let{name:d,value:b}=n[l];if(d.startsWith(B)){if(i.removeAttribute(d),oe=d,(a=fe(i,d,b,r))&&(t.push(a),o.push(a())),u in i)return}else l++}for(let l of[...i.childNodes])l.nodeType==1&&s(l)};return s(e),e[u]===void 0&&(e[u]=r),r},C=(e,r,t)=>{if(t=de[e])return t;let o=e.trim()||"undefined";r&&(o=r(o)),/^(if|let|const)\b/.test(o)||/;(?![^{]*})/.test(o)||(o=`return ${o}`),/\bawait\s/.test(o)&&(o=`return (async()=>{ ${o} })()`);try{t=me(o),Object.defineProperty(t,"name",{value:`\u2234 ${e}`})}catch(s){console.error(`\u2234 ${s}

${oe}="${e}"`)}return de[e]=function(s,i,n){try{let a=t?.call(this,s);return i?(a?.then?a.then(l=>n=i(l)):n=i(a),()=>m(n)):a}catch(a){console.error(`\u2234 ${a}

${oe}="${e}"`)}}},de={},U=e=>(e.compile&&(me=e.compile),e.prefix&&(B=e.prefix),e.signal&&(g=e.signal),e.effect&&(T=e.effect),e.computed&&(F=e.computed),e.batch&&(v=e.batch),e.untracked&&(D=e.untracked),e.dir&&(fe=e.dir)),w=e=>{if(!e.nodeType)return e;let r=e.content.cloneNode(!0),t=[...e.attributes],o=document.createTextNode(""),s=(r.append(o),[...r.childNodes]);return{childNodes:s,content:r,remove:()=>r.append(...s),replaceWith(i){i!==o&&(o.before(i),r.append(...s))},attributes:t,removeAttribute(i){t.splice(t.findIndex(n=>n.name===i),1)}}},m=(e,r)=>typeof e=="function"?e(r):e,he=e=>e.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,(r,t)=>(t?"-":"")+r.toLowerCase()),A=(e,r,t)=>t==null||t===!1?e.removeAttribute(r):e.setAttribute(r,t===!0?"":t),se=(e,r=[])=>e?typeof e=="string"?e:(Array.isArray(e)?e.map(se):Object.entries(e).reduce((t,[o,s])=>s?[...t,o]:t,[])).join(" "):"",W=(e,r=queueMicrotask)=>{let t=0,o=s=>{t++||(e(s),r((i=t>1)=>(t=0,i&&o(s))))};return o},ye=(e,r=queueMicrotask,t=0)=>(o,s=++t)=>r(()=>s==t&&e(o)),p=st});var j,_,ne,ie,E,it,ee,ge,q,Y=f(()=>{h();j=Symbol("signals"),_=Symbol("change"),ne=Symbol("set"),ie=!0,E=(e,r)=>{if(!e||e[Symbol.toStringTag]||e[j])return e;if(e.constructor!==Object)return Array.isArray(e)?it(e):e;let t=Object.keys(e).length,o={},s=new Proxy(Object.assign(o,{[_]:g(t),[j]:o}),{get:(n,a)=>a in o?o[a]?o[a].valueOf():o[a]:r?r[a]:globalThis[a],set:(n,a,l,d)=>a in o?(ge(o,a,l),1):(ie=!1,r&&a in r?r[a]=l:(ee(o,a,l),o[_].value=++t),ie=!0,1),deleteProperty:(n,a)=>(a in o&&(a[0]!="_"&&o[a]?.[Symbol.dispose]?.(),delete o[a],o[_].value=--t),1),ownKeys:()=>(o[_].value,Reflect.ownKeys(o)),has:(n,a)=>a in o?!0:r?a in r:ie}),i=Object.getOwnPropertyDescriptors(e);for(let n in e)i[n]?.get?(o[n]=F(i[n].get.bind(s)))[ne]=i[n].set?.bind(s):ee(o,n,e[n]);return s},it=(e,r=globalThis)=>{let t=Array(e.length).fill(null),o=!1,s=a=>function(){return o=!0,a.apply(this,arguments)},i=g(e.length),n=new Proxy(Object.assign(t,{[_]:i,[j]:t,push:s(t.push),pop:s(t.pop),shift:s(t.shift),unshift:s(t.unshift),splice:s(t.splice)}),{get(a,l){return l==="length"?o?(o=!1,t.length):i.value:typeof l=="symbol"||isNaN(l)?t[l]?.valueOf()??r[l]:(t[l]??(t[l]=g(E(e[l])))).valueOf()},set(a,l,d){if(l==="length"){for(let b=d;b<t.length;b++)delete n[b];i.value=t.length=d}else l>=t.length?(ee(t,l,d),n.length=+l+1):t[l]?ge(t,l,d):ee(t,l,d);return 1},deleteProperty:(a,l)=>(t[l]?.[Symbol.dispose]?.(),delete t[l],1)});return n},ee=(e,r,t)=>e[r]=r[0]=="_"||t?.peek?t:g(E(t)),ge=(e,r,t,o,s)=>r[0]==="_"?e[r]=t:t!==(s=(o=e[r]).peek())&&(o[ne]?o[ne](t):Array.isArray(t)&&Array.isArray(s)?_ in s?D(()=>v(()=>{for(let i=0;i<t.length;i++)s[i]=t[i];s.length=t.length})):o.value=t:o.value=E(t)),q=E});var ae={};pe(ae,{batch:()=>at,computed:()=>nt,effect:()=>Se,signal:()=>xe,untracked:()=>lt});var k,be,L,xe,Se,nt,at,lt,Ae=f(()=>{be=0,xe=(e,r,t=new Set,o=()=>r.value)=>r={get value(){return k?.deps.push(t.add(k)),e},set value(s){if(s!==e){e=s;for(let i of t)L?L.add(i):i()}},peek(){return e},toJSON:o,then:o,toString:o,valueOf:o},Se=(e,r,t,o,s)=>(t=i=>{if(s=r,r=null,s?.call?.(),i=k,k=t,be++>10)throw"Cycle detected";try{r=e()}finally{k=i,be--}},o=t.deps=[],t(),i=>{for(r?.call?.();i=o.pop();)i.delete(t)}),nt=(e,r=xe(),t,o,s=()=>t.value)=>t={get value(){return o||(o=Se(()=>r.value=e())),r.value},peek:r.peek,toJSON:s,then:s,toString:s,valueOf:s},at=(e,r=!L)=>{L??(L=new Set);try{e()}finally{if(r){for(let t of L)t();L=null}}},lt=(e,r,t)=>(r=k,k=null,t=e(),k=r,t)});var Oe,je=f(()=>{Oe={name:"sprae",description:"DOM microhydration",version:"12.2.4",main:"./sprae.js",module:"./sprae.js","umd:main":"dist/sprae.umd.js",unpkg:"dist/sprae.umd.js",types:"dist/sprae.d.ts",type:"module",files:["core.js","sprae.js","store.js","signal.js","micro.js","directive","dist"],devDependencies:{"@preact/signals":"^2.0.4","@preact/signals-core":"^1.8.0","@webreflection/signal":"^2.1.2","es-module-shims":"^1.10.0",esbuild:"^0.23.0","esbuild-plugin-umd-wrapper":"^2.0.3",hyperf:"^1.7.0",jsdom:"^27.0.0",requestidlecallback:"^0.3.0","signal-polyfill":"^0.1.1",subscript:"^9.1.0",tst:"^8.0.2",ulive:"^1.0.7",usignal:"^0.9.0","wait-please":"^3.1.0"},scripts:{test:"node -r ./test/register.cjs test/test.js",build:"node .esbuild.js"},repository:{type:"git",url:"git+https://github.com/dy/sprae.git"},keywords:["hydration","progressive","progressive enhancement","signals","directives","preact-signals","reactive","template-parts","petit-vue","alpinejs","templating"],author:"Dmitry Iv <df.creative@gmail.com>",license:"MIT",bugs:{url:"https://github.com/dy/sprae/issues"},homepage:"https://github.com/dy/sprae#readme"}});var _e,we=f(()=>{h();_e=(e,r)=>{var i;let t,o,s;return e._holder?p(o=e,r):(e[i=u]??(e[i]=null),o=e.content?w(e):e,e.replaceWith(t=document.createTextNode("")),o._holder=t._holder=t,t._clauses=[o._clause=[o,!1]],t.update=W(()=>{let n=t._clauses.find(([,a])=>a);n!=s&&(s?.[0].remove(),s?.[0][J]?.(),(s=n)&&(t.before(s[0].content||s[0]),s[0][u]?s[0][G]?.():(delete s[0][u],p(s[0],r))))})),n=>{o._clause[1]=n,o._holder.update()}}});var ke,Ne=f(()=>{h();ke=e=>{let r,t=e;for(r=e.content?w(e):e;t&&!(r._holder=t._holder);)t=t.previousSibling;return e.remove(),e[u]=null,r._holder._clauses.push(r._clause=[r,!0]),r._holder.update}});var $e,Te=f(()=>{h();$e=e=>(e.content&&e.replaceWith(e=w(e).childNodes[0]),r=>(r=m(r,e.textContent),e.textContent=r??""))});var De,Ce=f(()=>{h();De=(e,r,t)=>(r=new Set,o=>{t=new Set,o&&se(m(o,e.className)).split(" ").map(s=>s&&t.add(s));for(let s of r)t.has(s)?t.delete(s):e.classList.remove(s);for(let s of r=t)e.classList.add(s)})});var Ee,Pe=f(()=>{h();Ee=(e,r)=>(r=e.getAttribute("style"),t=>{if(t=m(t,e.style),typeof t=="string")A(e,"style",r+"; "+t);else{r&&A(e,"style",r);for(let o in t)o[0]=="-"?e.style.setProperty(o,t[o]):o[0]>"A"&&(e.style[o]=t[o])}})});var ve,Me=f(()=>{h();ve=()=>m});var ut,We,qe=f(()=>{h();ut=(e,r=C(`${e}=__`))=>(t,o)=>{t.__=o,r(t),delete t.__},We=(e,r,t,o)=>{try{let s=ut(t),i=e.type==="checkbox"?()=>s(r,e.checked):e.type==="select-multiple"?()=>s(r,[...e.selectedOptions].map(n=>n.value)):()=>s(r,e.selectedIndex<0?null:isNaN(e.valueAsNumber)?e.value:e.valueAsNumber);e.oninput=e.onchange=i,e.type?.startsWith("select")&&(new MutationObserver(i).observe(e,{childList:!0,subtree:!0,attributes:!0}),p(e,r)),C(t)(r)??i()}catch{}return e.type==="text"||e.type===""||e.tagName==="TEXTAREA"?(s,i,n)=>(i=e.selectionStart,n=e.selectionEnd,e.setAttribute("value",e.value=s??""),i&&e.setSelectionRange(i,n)):e.type==="checkbox"?s=>(e.checked=s,A(e,"checked",s)):e.type==="radio"?s=>e.value===s&&(e.checked=s,A(e,"checked",s)):e.type==="select-one"?s=>{for(let i of e.options)i.value==s?i.setAttribute("selected",""):i.removeAttribute("selected");e.value=s}:e.type==="select-multiple"?s=>{for(let i of e.options)i.removeAttribute("selected");for(let i of s)e.querySelector(`[value="${i}"]`).setAttribute("selected","")}:s=>e.value=s}});var Le,Ke=f(()=>{h();Le=(e,r,t,o,s,i)=>{if(typeof C(t)(r)=="function")return n=>n(e);Object.defineProperty(r,t,{value:e,configurable:!0})}});var Ie,Re=f(()=>{h();Ie=(e,r)=>{let t=e[u]=E({},r),o=!1;return s=>{if(s=m(s,t),s!==t)for(let i in s){let n=typeof s[i]=="function"?s[i].bind(t):s[i];i in t[j]?t[i]=n:t[j][i]=i[0]=="_"||n?.peek?n:g(E(n))}return!o&&(o=!0,delete e[u],D(()=>p(e,t)))}}});var Ve,Je,Be=f(()=>{h();Ve=(e,r,t)=>{let[o,s="$"]=t.split(/\bin\b/)[0].trim().replace(/\(|\)/g,"").split(/\s*,\s*/),i=document.createTextNode(""),n,a,l,d=0,b=W(()=>{var N,$;let c=0,y=l,x=y.length;if(n&&!n[_]){for(let S of n[j]||[])S[Symbol.dispose]();n=null,d=0}if(x<d)n.length=x;else{if(!n)n=y;else for(;c<d;)n[c]=y[c++];for(;c<x;c++){n[c]=y[c];let S=c,Z=Object.create(r,{[o]:{get:()=>n[S]},[s]:{value:a?a[S]:S}}),O=e.content?w(e):e.cloneNode(!0);i.before(O.content||O),p(O,Z);let I=(($=n[N=j]||(n[N]=[]))[c]||($[c]={}))[Symbol.dispose];n[j][c][Symbol.dispose]=()=>{I?.(),O[Symbol.dispose]?.(),O.remove()}}}d=x});return e.replaceWith(i),e[u]=null,c=>(a=null,typeof c=="number"?l=Array.from({length:c},(y,x)=>x+1):c?.constructor===Object?(a=Object.keys(c),l=Object.values(c)):l=c||[],T(()=>{l[_]?.value,b()}))};Ve.parse=e=>e.split(/\bin\b/)[1].trim();Je=Ve});var Fe,He=f(()=>{h();Fe=(e,r,t,o)=>s=>A(e,o,m(s,e.getAttribute(o)))});var Xe,Ze=f(()=>{h();Xe=e=>r=>{for(let t in r)A(e,he(t),r[t])}});var Ge={};pe(Ge,{batch:()=>v,computed:()=>F,default:()=>ft,effect:()=>T,signal:()=>g,sprae:()=>p,start:()=>dt,store:()=>q,untracked:()=>D,use:()=>U});var le,pt,ze,ce,dt,ft,Qe=f(()=>{Y();h();Ae();h();je();we();Ne();Te();Ce();Pe();Me();qe();Ke();Re();Be();He();Ze();Object.assign(M,{_:Fe,"":Xe,class:De,text:$e,style:Ee,fx:ve,value:We,ref:Le,scope:Ie,if:_e,else:ke,each:Je});Object.assign(H,{debounce:(e,r=250)=>ye(e,(r||(r=0),t=>setTimeout(t,r))),throttle:(e,r=250)=>W(e,(r||(r=0),t=>setTimeout(t,r))),tick:e=>r=>queueMicrotask(()=>e(r)),raf:e=>r=>requestAnimationFrame(()=>e(r)),once:(e,r,t)=>Object.assign(o=>!r&&(r=1,e(o)),{once:!0}),window:e=>(e.target=e.target.ownerDocument.defaultView,e),document:e=>(e.target=e.target.ownerDocument,e),root:e=>(e.target=e.target.ownerDocument.documentElement,e),body:e=>(e.target=e.target.ownerDocument.body,e),parent:e=>(e.target=e.target.parentNode,e),self:e=>r=>r.target===e.target&&e(r),outside:e=>(r,t)=>(t=e.target,!t.contains(r.target)&&r.target.isConnected&&(t.offsetWidth||t.offsetHeight)),prevent:e=>r=>(r?.preventDefault(),e(r)),stop:e=>r=>(r?.stopPropagation(),e(r)),immediate:e=>r=>(r?.stopImmediatePropagation(),e(r)),passive:e=>(e.passive=!0,e),capture:e=>(e.capture=!0,e)});le={ctrl:e=>e.ctrlKey||e.key==="Control"||e.key==="Ctrl",shift:e=>e.shiftKey||e.key==="Shift",alt:e=>e.altKey||e.key==="Alt",meta:e=>e.metaKey||e.key==="Meta",cmd:e=>e.metaKey||e.key==="Command",arrow:e=>e.key.startsWith("Arrow"),enter:e=>e.key==="Enter",esc:e=>e.key.startsWith("Esc"),tab:e=>e.key==="Tab",space:e=>e.key==="\xA0"||e.key==="Space"||e.key===" ",delete:e=>e.key==="Delete"||e.key==="Backspace",digit:e=>/^\d$/.test(e.key),letter:e=>/^\p{L}$/gu.test(e.key),char:e=>/^\S$/.test(e.key)};for(let e in le)H[e]=(r,...t)=>o=>le[e](o)&&t.every(s=>le[s]?.(o)??o.key===s)&&r(o);pt=(e,r,t,o)=>{let s,i,n=r.slice(B.length).split("..").map((a,l,{length:d})=>a.split(B).reduce((b,c)=>{let[y,...x]=c.split("."),N=C(t,M[y]?.parse).bind(e);if(y.startsWith("on")){let R=y.slice(2),V=ze(ce(d==1?P=>N(o,te=>m(te,P)):P=>(s=(l?s:te=>m(N(o),te))(P),i(),i=n[(l+1)%d]()),{target:e}),x);return P=>(P=b?.(),V.target.addEventListener(R,V,V),()=>(P?.(),V.target.removeEventListener(R,V)))}let $,S=g(0),Z=0,O=x.length?ze(ce(()=>{S.value++||($=T(()=>S.value==Z?O():(Z=S.value,N(o,I))))},{target:e}),x):()=>$=T(()=>N(o,I)),I=(M[y]||M._)(O.target||e,o,t,y);if(I)return e[u]&&(o=e[u]),R=>(R=b?.(),O(),()=>(R?.(),$?.(),S=$=null))},null));return()=>i=n[0]?.()},ze=(e,r)=>{for(;r.length;){let[t,...o]=r.pop().split("-");e=ce(H[t]?.(e,...o)??e,e)}return e},ce=(e,r)=>{if(e!=r)for(let t in r)e[t]??(e[t]=r[t]);return e};U({compile:e=>p.constructor(`with (arguments[0]) { ${e} }`),dir:pt,...ae});p.use=U;p.store=q;p.directive=M;p.modifier=H;p.version=Oe.version;dt=p.start=(e=document.body,r)=>{let t=q(r);return p(e,t),new MutationObserver(s=>{for(let i of s)for(let n of i.addedNodes)n.nodeType===1&&n[u]===void 0&&e.contains(n)&&e[Q](n)}).observe(e,{childList:!0,subtree:!0}),t},ft=p});var ue=(Qe(),ot(Ge)).default;module.exports=ue;var K=document.currentScript,Ue=K.getAttribute("prefix")??K.dataset.prefix??K.dataset.spraePrefix,X=K.getAttribute("start")??K.dataset.start??K.dataset.spraeStart;Ue&&ue.use({prefix:Ue});X!=null&&X!=="false"&&(X&&X!=="true"?document.querySelectorAll(X):[document.body||document.documentElement]).forEach(e=>ue.start(e));
;if (typeof module.exports == "object" && typeof exports == "object") {
  var __cp = (to, from, except, desc) => {
    if ((from && typeof from === "object") || typeof from === "function") {
      for (let key of Object.getOwnPropertyNames(from)) {
        if (!Object.prototype.hasOwnProperty.call(to, key) && key !== except)
        Object.defineProperty(to, key, {
          get: () => from[key],
          enumerable: !(desc = Object.getOwnPropertyDescriptor(from, key)) || desc.enumerable,
        });
      }
    }
    return to;
  };
  module.exports = __cp(module.exports, exports);
}
return module.exports;
}))
