(function (g, f) {if ("object" == typeof exports && "object" == typeof module) {module.exports = f();} else if ("function" == typeof define && define.amd) {define("sprae", [], f);} else if ("object" == typeof exports) {exports["sprae"] = f();} else {g["sprae"] = f();}}(typeof self !== 'undefined' ? self : typeof globalThis !== 'undefined' ? globalThis : this, () => {var exports = {};var module = { exports };
var Y=Object.defineProperty;var Ye=Object.getOwnPropertyDescriptor;var et=Object.getOwnPropertyNames;var tt=Object.prototype.hasOwnProperty;var f=(e,r)=>()=>(e&&(r=e(e=0)),r);var ae=(e,r)=>{for(var t in r)Y(e,t,{get:r[t],enumerable:!0})},rt=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of et(r))!tt.call(e,s)&&s!==t&&Y(e,s,{get:()=>r[s],enumerable:!(o=Ye(r,s))||o.enumerable});return e};var ot=e=>rt(Y({},"__esModule",{value:!0}),e);var $,d,Z,V,z,ee,x,L,J,P,D,B,H,te,st,ce,ue,y,le,F,_,N,m,pe,S,re,E,de,p,g=f(()=>{G();G();$=Symbol.dispose||(Symbol.dispose=Symbol("dispose")),d=Symbol("state"),Z=Symbol("on"),V=Symbol("off"),z=Symbol("init"),ee=":",P=e=>e(),D=P,B={},H={},te=null,st=(e=document.body,r)=>{if(e[d])return Object.assign(e[d],r);r=W(r||{});let t=[],o=[];e[Z]=()=>!o&&(o=t.map(i=>i())),e[V]=()=>(o?.map(i=>i()),o=null),e[$]||(e[$]=()=>(e[V](),e[V]=e[Z]=e[$]=e[z]=e[d]=null));let s=e[z]=i=>{let n=i.attributes,a;if(n)for(let l=0;l<n.length;){let{name:c,value:h}=n[l];if(c.startsWith(ee)){if(i.removeAttribute(c),te=c,t.push(a=ce(i,c.slice(ee.length),h,r)),o.push(a()),d in i)return}else l++}for(let l of[...i.childNodes])l.nodeType==1&&s(l)};return s(e),e[d]===void 0&&(e[d]=r),r},y=e=>{let r=le[e=e.trim()];if(r)return r;let t=e||"undefined";/^(if|let|const)\b/.test(t)||/;(?![^{]*})/.test(t)||(t=`return ${t}`),/\bawait\s/.test(t)&&(t=`return (async()=>{ ${t} })()`);try{r=ue(t)}catch(o){console.error(`\u2234 ${o}

${te}="${e}"`)}return le[e]=function(o,s,i){try{let n=r?.call(this,o);return s?n?.then?(n.then(a=>i=s(a)),()=>i&&m(i)):s(n):n}catch(n){console.error(`\u2234 ${n}

${te}="${e}"`)}}},le={},F=e=>(e.compile&&(ue=e.compile),e.prefix&&(ee=e.prefix),e.signal&&(x=e.signal),e.effect&&(L=e.effect),e.computed&&(J=e.computed),e.batch&&(P=e.batch),e.untracked&&(D=e.untracked),e.dir&&(ce=e.dir)),_=(e,r)=>{for(;r.length;){let[t,...o]=r.pop().split("-"),s=H[t],i;if(s&&(i=s(e,...o))!==e){for(let n in e)i[n]??(i[n]=e[n]);e=i}}return e},N=e=>{if(!e.nodeType)return e;let r=e.content.cloneNode(!0),t=[...e.attributes],o=document.createTextNode(""),s=(r.append(o),[...r.childNodes]);return{childNodes:s,content:r,remove:()=>r.append(...s),replaceWith(i){i!==o&&(o.before(i),r.append(...s))},attributes:t,removeAttribute(i){t.splice(t.findIndex(n=>n.name===i),1)}}},m=(e,r)=>typeof e=="function"?e(r):e,pe=e=>e.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,(r,t)=>(t?"-":"")+r.toLowerCase()),S=(e,r,t)=>t==null||t===!1?e.removeAttribute(r):e.setAttribute(r,t===!0?"":t),re=(e,r=[])=>e?typeof e=="string"?e:(Array.isArray(e)?e.map(re):Object.entries(e).reduce((t,[o,s])=>s?[...t,o]:t,[])).join(" "):"",E=(e,r=queueMicrotask)=>{let t=0,o,s=i=>{o=i,t++||(e(o),r((n=t>1)=>(t=0,n&&s(o))))};return s},de=(e,r=queueMicrotask,t=0)=>(o,s=++t)=>r(()=>s==t&&e(o)),p=st});var j,w,se,oe,C,it,Q,fe,W,G=f(()=>{g();j=Symbol("signals"),w=Symbol("change"),se=Symbol("set"),oe=!0,C=(e,r)=>{if(!e||e[Symbol.toStringTag]||e[j])return e;if(e.constructor!==Object)return Array.isArray(e)?it(e):e;let t=Object.keys(e).length,o={},s=new Proxy(Object.assign(o,{[w]:x(t),[j]:o}),{get:(n,a)=>a in o?o[a]?o[a].valueOf():o[a]:r?r[a]:globalThis[a],set:(n,a,l,c)=>a in o?(fe(o,a,l),1):(oe=!1,r&&a in r?r[a]=l:(Q(o,a,l),o[w].value=++t),oe=!0,1),deleteProperty:(n,a)=>(a in o&&(a[0]!="_"&&o[a]?.[Symbol.dispose]?.(),delete o[a],o[w].value=--t),1),ownKeys:()=>(o[w].value,Reflect.ownKeys(o)),has:(n,a)=>a in o?!0:r?a in r:oe}),i=Object.getOwnPropertyDescriptors(e);for(let n in e)i[n]?.get?(o[n]=J(i[n].get.bind(s)))[se]=i[n].set?.bind(s):Q(o,n,e[n]);return s},it=(e,r=globalThis)=>{let t=Array(e.length).fill(null),o=!1,s=a=>function(){return o=!0,a.apply(this,arguments)},i=x(e.length),n=new Proxy(Object.assign(t,{[w]:i,[j]:t,push:s(t.push),pop:s(t.pop),shift:s(t.shift),unshift:s(t.unshift),splice:s(t.splice)}),{get(a,l){return l==="length"?o?(o=!1,t.length):i.value:typeof l=="symbol"||isNaN(l)?t[l]?.valueOf()??r[l]:(t[l]??(t[l]=x(C(e[l])))).valueOf()},set(a,l,c){if(l==="length"){for(let h=c;h<t.length;h++)delete n[h];i.value=t.length=c}else l>=t.length?(Q(t,l,c),n.length=+l+1):t[l]?fe(t,l,c):Q(t,l,c);return 1},deleteProperty:(a,l)=>(t[l]?.[Symbol.dispose]?.(),delete t[l],1)});return n},Q=(e,r,t)=>e[r]=r[0]=="_"||t?.peek?t:x(C(t)),fe=(e,r,t,o,s)=>r[0]==="_"?e[r]=t:t!==(s=(o=e[r]).peek())&&(o[se]?o[se](t):Array.isArray(t)&&Array.isArray(s)?w in s?D(()=>P(()=>{for(let i=0;i<t.length;i++)s[i]=t[i];s.length=t.length})):o.value=t:o.value=C(t)),W=C});var ie={};ae(ie,{batch:()=>at,computed:()=>nt,effect:()=>he,signal:()=>ge,untracked:()=>lt});var v,me,q,ge,he,nt,at,lt,ye=f(()=>{me=0,ge=(e,r,t=new Set,o=()=>r.value)=>r={get value(){return v?.deps.add(t.add(v)),e},set value(s){if(s!==e){e=s;for(let i of t)q?q.add(i):i()}},peek(){return e},toJSON:o,toString:o,valueOf:o},he=(e,r,t,o)=>(t=s=>{let i=r;if(r=null,i?.call?.(),s=v,v=t,me++>10)throw"Cycle detected";try{r=e()}finally{v=s,me--}},t.fn=e,o=t.deps=new Set,t(),s=>{r?.call?.();for(s of o)s.delete(t);o.clear()}),nt=(e,r=ge(),t,o,s=()=>t.value)=>t={get value(){return o||(o=he(()=>r.value=e())),r.value},peek:r.peek,toJSON:s,toString:s,valueOf:s},at=(e,r=!q,t)=>{q??(q=new Set);try{e()}finally{if(r){[q,t]=[null,q];for(let o of t)o()}}},lt=(e,r,t)=>(r=v,v=null,t=e(),v=r,t)});var xe,be=f(()=>{xe={name:"sprae",description:"DOM microhydration",version:"12.3.0",main:"./sprae.js",module:"./sprae.js","umd:main":"dist/sprae.umd.js",unpkg:"dist/sprae.umd.js",types:"dist/sprae.d.ts",type:"module",files:["core.js","sprae.js","store.js","signal.js","micro.js","directive","dist"],devDependencies:{"@preact/signals":"^2.0.4","@preact/signals-core":"^1.8.0","@webreflection/signal":"^2.1.2","es-module-shims":"^1.10.0",esbuild:"^0.23.0","esbuild-plugin-umd-wrapper":"^2.0.3","esbuild-plugin-version-injector":"^1.2.1",hyperf:"^1.7.0",jsdom:"^27.0.0",requestidlecallback:"^0.3.0","signal-polyfill":"^0.1.1",subscript:"^9.1.0",tst:"^8.0.2",ulive:"^1.0.7",usignal:"^0.9.0","wait-please":"^3.1.0"},scripts:{test:"node -r ./test/register.cjs test/test.js",build:"node .esbuild.js"},repository:{type:"git",url:"git+https://github.com/dy/sprae.git"},keywords:["hydration","progressive","progressive enhancement","signals","directives","preact-signals","reactive","template-parts","petit-vue","alpinejs","templating"],author:"Dmitry Iv <df.creative@gmail.com>",license:"MIT",bugs:{url:"https://github.com/dy/sprae/issues"},homepage:"https://github.com/dy/sprae#readme"}});var _e,Se=f(()=>{g();_e=(e,r)=>{var i;let t,o,s;return e._holder?p(o=e,r):(e[i=d]??(e[i]=null),o=e.content?N(e):e,e.replaceWith(t=document.createTextNode("")),o._holder=t._holder=t,t._clauses=[o._clause=[o,!1]],t.update=E(()=>{let n=t._clauses.find(([,a])=>a);n!=s&&(s?.[0].remove(),s?.[0][V]?.(),(s=n)&&(t.before(s[0].content||s[0]),s[0][d]?s[0][Z]?.():(delete s[0][d],p(s[0],r))))})),n=>{o._clause[1]=n,o._holder.update()}}});var je,Ae=f(()=>{g();je=e=>{let r,t=e;for(r=e.content?N(e):e;t&&!(r._holder=t._holder);)t=t.previousSibling;return e.remove(),e[d]=null,r._holder._clauses.push(r._clause=[r,!0]),r._holder.update}});var we,Oe=f(()=>{g();we=e=>(e.content&&e.replaceWith(e=N(e).childNodes[0]),r=>(r=r&&m(r,e.textContent),e.textContent=r??""))});var ke,Ne=f(()=>{g();ke=(e,r,t,o)=>{let s=new Set,i;return o.includes(".")&&(e=_({target:e},o.split(".").slice(1)).target??e),n=>{i=new Set,n&&re(m(n,e.className)).split(" ").map(a=>a&&i.add(a));for(let a of s)i.has(a)?i.delete(a):e.classList.remove(a);for(let a of s=i)e.classList.add(a)}}});var ve,Te=f(()=>{g();ve=(e,r,t,o)=>{let s;return o.includes(".")&&(e=_({target:e},o.split(".").slice(1)).target??e),i=>{if(s||(s=e.getAttribute("style")),i&&(i=m(i,e.style)),typeof i=="string")S(e,"style",s+"; "+i);else{s&&S(e,"style",s);for(let n in i)n[0]=="-"?e.style.setProperty(n,i[n]):n[0]>"A"&&(e.style[n]=i[n])}}}});var $e,De=f(()=>{g();$e=()=>m});var ut,Ee,Ce=f(()=>{g();ut=(e,r=y(`${e}=__`))=>(t,o)=>{t.__=o,r(t),delete t.__},Ee=(e,r,t)=>{try{let o=ut(t),s=e.type==="checkbox"?()=>o(r,e.checked):e.type==="select-multiple"?()=>o(r,[...e.selectedOptions].map(i=>i.value)):()=>o(r,e.selectedIndex<0?null:isNaN(e.valueAsNumber)?e.value:e.valueAsNumber);e.oninput=e.onchange=s,e.type?.startsWith("select")&&(new MutationObserver(s).observe(e,{childList:!0,subtree:!0,attributes:!0}),p(e,r)),y(t)(r)??s()}catch{}return e.type==="text"||e.type===""||e.tagName==="TEXTAREA"?(o,s,i)=>(s=e.selectionStart,i=e.selectionEnd,e.setAttribute("value",e.value=o??""),s&&e.setSelectionRange(s,i)):e.type==="checkbox"?o=>(e.checked=o,S(e,"checked",o)):e.type==="radio"?o=>e.value===o&&(e.checked=o,S(e,"checked",o)):e.type==="select-one"?o=>{for(let s of e.options)s.value==o?s.setAttribute("selected",""):s.removeAttribute("selected");e.value=o}:e.type==="select-multiple"?o=>{for(let s of e.options)s.removeAttribute("selected");for(let s of o)e.querySelector(`[value="${s}"]`).setAttribute("selected","")}:o=>e.value=o}});var Le,Pe=f(()=>{g();Le=(e,r,t)=>{let o=y(t)(r);if(typeof o=="function")return{[Symbol.dispose]:o(e)};Object.defineProperty(r,t,{value:e,configurable:!0})}});var We,qe=f(()=>{g();We=(e,r)=>{let t=e[d]=C({},r),o=!1;return s=>{if(s=m(s,t),s!==t)for(let i in s){let n=typeof s[i]=="function"?s[i].bind(t):s[i];i in t[j]?t[i]=n:t[j][i]=i[0]=="_"||n?.peek?n:x(C(n))}return!o&&(o=!0,delete e[d],D(()=>p(e,t)))}}});var Me,Ke=f(()=>{g();Me=(e,r,t)=>{let[o,s]=t.split(/\bin\b/),[i,n="$"]=o.trim().replace(/\(|\)/g,"").split(/\s*,\s*/),a=document.createTextNode(""),l,c,h,O=0,A=E(()=>{var k,K;let u=0,T=h,b=T.length;if(l&&!l[w]){for(let I of l[j]||[])I[Symbol.dispose]();l=null,O=0}if(b<O)l.length=b;else{if(!l)l=T;else for(;u<O;)l[u]=T[u++];for(;u<b;u++){l[u]=T[u];let I=u,Qe=Object.create(r,{[i]:{get:()=>l[I]},[n]:{value:c?c[I]:I}}),R=e.content?N(e):e.cloneNode(!0);a.before(R.content||R),p(R,Qe);let Ue=((K=l[k=j]||(l[k]=[]))[u]||(K[u]={}))[Symbol.dispose];l[j][u][Symbol.dispose]=()=>{Ue?.(),R[Symbol.dispose]?.(),R.remove()}}}O=b});return e.replaceWith(a),e[d]=null,Object.assign(u=>(c=null,typeof u=="number"?h=Array.from({length:u},(T,b)=>b+1):u?.constructor===Object?(c=Object.keys(u),h=Object.values(u)):h=u||[],L(()=>{h[w]?.value,A()})),{eval:y(s)})}});var Ie,Re=f(()=>{g();Ie=(e,r,t,o)=>s=>S(e,o,s&&m(s,e.getAttribute(o)))});var Ve,Je=f(()=>{g();Ve=e=>r=>{for(let t in r)S(e,pe(t),r[t])}});var Be,He=f(()=>{g();Be=(e,r,t,o)=>{let[s,...i]=o.slice(2).split("."),n=y(t).bind(e),a=_(Object.assign(l=>n(r,c=>c&&m(c,l)),{target:e}),i);return a.target.addEventListener(s,a,a),{[Symbol.dispose](){a.target.removeEventListener(s,a)}}}});var Xe,Ze=f(()=>{g();Xe=(e,r,t,o)=>{let s,i,n=o.split("..").map((a,l,{length:c})=>a.split(":").reduce((h,O)=>{let[A,...u]=O.slice(2).split("."),T=y(t).bind(e),b=_(Object.assign(k=>(l?s=s(k):T(r,K=>s=K&&m(K,k)),i(),i=n[(l+1)%c]()),{target:e}),u);return k=>(k=h?.(),b.target.addEventListener(A,b,b),()=>(k?.(),b.target.removeEventListener(A,b)))},null));return i=n[0](),{[Symbol.dispose](){i?.()}}}});var ze={};ae(ze,{batch:()=>P,computed:()=>J,default:()=>ft,effect:()=>L,signal:()=>x,sprae:()=>p,start:()=>dt,store:()=>W,untracked:()=>D,use:()=>F});var pt,U,dt,ft,Fe=f(()=>{G();g();ye();g();be();Se();Ae();Oe();Ne();Te();De();Ce();Pe();qe();Ke();Re();Je();He();Ze();Object.assign(B,{_:(e,r,t,o)=>(o.startsWith("on")?Be:Ie)(e,r,t,o),"":Ve,class:ke,text:we,style:ve,fx:$e,value:Ee,ref:Le,scope:We,if:_e,else:je,each:Me});pt=(e,r,t,o)=>{let[s,...i]=r.split("."),n=B[s]||B._;return()=>{let a=n(e,o,t,r);if(!a?.call)return a?.[$];let l=_(Object.assign(E(()=>c.value++),{target:e}),i),c=x(0),h=0,O=a.eval??y(t).bind(e),A,u=()=>(A&&m(A),A=null);return o=e[d]??o,L(()=>(c.value==h?l():(h=c.value,A=O(o,a)),u))}};Object.assign(H,{debounce:(e,r=250)=>de(e,(r||(r=0),t=>setTimeout(t,r))),throttle:(e,r=250)=>E(e,(r||(r=0),t=>setTimeout(t,r))),tick:e=>r=>queueMicrotask(()=>e(r)),raf:e=>r=>requestAnimationFrame(()=>e(r)),once:(e,r,t)=>(t=o=>!r&&(r=1,e(o)),t.once=!0,t),window:e=>(e.target=e.target.ownerDocument.defaultView,e),document:e=>(e.target=e.target.ownerDocument,e),root:e=>(e.target=e.target.ownerDocument.documentElement,e),body:e=>(e.target=e.target.ownerDocument.body,e),parent:e=>(e.target=e.target.parentNode,e),self:e=>r=>r.target===e.target&&e(r),outside:e=>(r,t)=>(t=e.target,!t.contains(r.target)&&r.target.isConnected&&(t.offsetWidth||t.offsetHeight)),prevent:e=>r=>(r?.preventDefault(),e(r)),stop:e=>r=>(r?.stopPropagation(),e(r)),immediate:e=>r=>(r?.stopImmediatePropagation(),e(r)),passive:e=>(e.passive=!0,e),capture:e=>(e.capture=!0,e)});U={ctrl:e=>e.ctrlKey||e.key==="Control"||e.key==="Ctrl",shift:e=>e.shiftKey||e.key==="Shift",alt:e=>e.altKey||e.key==="Alt",meta:e=>e.metaKey||e.key==="Meta",cmd:e=>e.metaKey||e.key==="Command",arrow:e=>e.key.startsWith("Arrow"),enter:e=>e.key==="Enter",esc:e=>e.key.startsWith("Esc"),tab:e=>e.key==="Tab",space:e=>e.key==="\xA0"||e.key==="Space"||e.key===" ",delete:e=>e.key==="Delete"||e.key==="Backspace",digit:e=>/^\d$/.test(e.key),letter:e=>/^\p{L}$/gu.test(e.key),char:e=>/^\S$/.test(e.key)};for(let e in U)H[e]=(r,t,o)=>s=>U[e](s)&&(!t||U[t]?.(s))&&(!o||U[o]?.(s))&&r(s);F({compile:e=>p.constructor(`with (arguments[0]) { ${e} }`),dir:(e,r,t,o)=>r.includes("..")?()=>Xe(e,o,t,r)[$]:r.split(":").reduce((s,i)=>{let n=pt(e,i,t,o);return s?(a,l)=>(a=s(),l=n(),()=>{a(),l()}):n},null),...ie});p.use=F;p.store=W;p.directive=B;p.modifier=H;p.version=xe.version;dt=p.start=(e=document.body,r)=>{let t=W(r);return p(e,t),new MutationObserver(s=>{for(let i of s)for(let n of i.addedNodes)n.nodeType===1&&n[d]===void 0&&e.contains(n)&&e[z](n)}).observe(e,{childList:!0,subtree:!0}),t};p.version="12.3.0";ft=p});var ne=(Fe(),ot(ze)).default;module.exports=ne;var M=document.currentScript,Ge=M.getAttribute("prefix")??M.dataset.prefix??M.dataset.spraePrefix,X=M.getAttribute("start")??M.dataset.start??M.dataset.spraeStart;Ge&&ne.use({prefix:Ge});X!=null&&X!=="false"&&(X&&X!=="true"?document.querySelectorAll(X):[document.body||document.documentElement]).forEach(e=>ne.start(e));
;if (typeof module.exports == "object" && typeof exports == "object") {
  var __cp = (to, from, except, desc) => {
    if ((from && typeof from === "object") || typeof from === "function") {
      for (let key of Object.getOwnPropertyNames(from)) {
        if (!Object.prototype.hasOwnProperty.call(to, key) && key !== except)
        Object.defineProperty(to, key, {
          get: () => from[key],
          enumerable: !(desc = Object.getOwnPropertyDescriptor(from, key)) || desc.enumerable,
        });
      }
    }
    return to;
  };
  module.exports = __cp(module.exports, exports);
}
return module.exports;
}))
