(function($,_){typeof exports=="object"&&typeof module=="object"?module.exports=_():typeof define=="function"&&define.amd?define("sprae",[],_):typeof exports=="object"?exports.sprae=_():$.sprae=_()})(typeof self<"u"?self:typeof globalThis<"u"?globalThis:void 0,()=>{var $={},_={exports:$},V=Object.defineProperty,ve=Object.getOwnPropertyDescriptor,le=Object.getOwnPropertyNames,je=Object.prototype.hasOwnProperty,d=(e,r)=>function(){return e&&(r=(0,e[le(e)[0]])(e=0)),r},Oe=(e,r)=>{for(var t in r)V(e,t,{get:r[t],enumerable:!0})},we=(e,r,t,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of le(r))!je.call(e,n)&&n!==t&&V(e,n,{get:()=>r[n],enumerable:!(i=ve(r,n))||i.enumerable});return e},ue=e=>we(V({},"__esModule",{value:!0}),e),W,A,k,B,E,H,ce,X=d({"signal.js"(){A=(e,r,t=new Set)=>(r={get value(){return W?.deps.push(t.add(W)),e},set value(i){if(i!==e){e=i;for(let n of t)n()}},peek(){return e}},r.toJSON=r.then=r.toString=r.valueOf=()=>r.value,r),k=(e,r,t,i)=>(t=n=>{r?.call?.(),n=W,W=t;try{r=e()}finally{W=n}},i=t.deps=[],t(),n=>{for(r?.call?.();n=i.pop();)n.delete(t)}),B=(e,r=A(),t,i)=>(t={get value(){return i||(i=k(()=>r.value=e())),r.value},peek:r.peek},t.toJSON=t.then=t.toString=t.valueOf=()=>t.value,t),E=e=>e(),H=E,ce=e=>(A=e.signal,k=e.effect,B=e.computed,E=e.batch||E,H=e.untracked||H)}}),j,P,L,N,fe,de,J,Z,z,G,C=d({"store.js"(){X(),p(),j=Symbol("signals"),P=Symbol("change"),L="__",N=(e,r)=>{if(!e||e[j]||e[Symbol.toStringTag])return e;if(e.constructor!==Object)return Array.isArray(e)?fe(e):e;let t={...r?.[j]},i=A(Object.keys(e).length),n,o=new Proxy(t,{get:(u,a)=>a===P?i:a===j?t:a===L?n:t[a]?.valueOf(),set:(u,a,y,g)=>(a===L?n=y:g=a in t,J(t,a,y),g||++i.value),deleteProperty:(u,a)=>(t[a]&&(t[a][Symbol.dispose]?.(),delete t[a],i.value--),1),ownKeys:()=>(i.value,Reflect.ownKeys(t))}),s=Object.getOwnPropertyDescriptors(e);for(let u in e)s[u]?.get?(t[u]=B(s[u].get.bind(o)))._set=s[u].set?.bind(o):(t[u]=null,J(t,u,e[u]));return o},fe=e=>{let r,t=A(e.length),i=Array(e.length).fill(),n=new Proxy(i,{get(o,s){return typeof s=="symbol"?s===P?t:s===j?i:i[s]:s==="length"?de.includes(r)?t.peek():t.value:(r=s,(i[s]??(i[s]=A(N(e[s])))).valueOf())},set(o,s,u){if(s==="length"){for(let a=u;a<i.length;a++)delete n[a];t.value=i.length=u}else J(i,s,u),s>=t.peek()&&(t.value=i.length=+s+1);return 1},deleteProperty:(o,s)=>(i[s]?.[Symbol.dispose]?.(),delete i[s],1)});return n},de=["push","pop","shift","unshift","splice"],J=(e,r,t)=>{let i=e[r],n;r[0]==="_"?e[r]=t:i?t===(n=i.peek())||(i._set?i._set(t):Array.isArray(t)&&Array.isArray(n)?n[P]?E(()=>{for(let o=0;o<t.length;o++)n[o]=t[o];n.length=t.length}):i.value=t:i.value=N(t)):e[r]=i=t?.peek?t:A(N(t))},Z=(e,r=q(`${e}=${L}`))=>(t,i)=>(t[L]=i,r(t)),z=(e,r,t=r.match(/^\w+(?=\s*(?:\.|\[|$))/))=>{var i,n;return t&&((i=e[j])[n=t[0]]??(i[n]=null))},G=N}}),Q,m,R,D,T,h,U,q,Y,ee,pe,F,K,w,p=d({"core.js"(){X(),C(),Q=Symbol.dispose||(Symbol.dispose=Symbol("dispose")),m=Symbol("state"),R=Symbol("on"),D=Symbol("off"),T={},h=(e,r,t=q)=>T[e]=(i,n,o,s,u,a)=>(a=t(n),u=r(i,o,n,s,a),()=>u(a(o))),U=(e=document.body,r)=>{if(e[m])return Object.assign(e[m],r);let t=N(r||{}),i=[],n=[],o=(s,u=s.attributes)=>{if(u)for(let a=0;a<u.length;){let{name:y,value:g}=u[a],l,c;if(y.startsWith(F)){s.removeAttribute(y);for(c of y.slice(F.length).split(":"))if(l=(T[c]||T.default)(s,g,t,c),n.push(l),i.push(k(l)),s[m]===null)return}else a++}for(let a of s.childNodes)a.nodeType==1&&o(a)};return o(e),m in e||(e[m]=t,e[D]=()=>(i.map(s=>s()),i=[]),e[R]=()=>i=n.map(s=>k(s)),e[Q]=()=>(e[D](),e[D]=e[R]=e[Q]=e[m]=null)),t},U.use=e=>(e.signal&&ce(e),e.compile&&(pe=e.compile),e.prefix&&(F=e.prefix)),q=(e,r,t)=>{if(t=Y[e=e.trim()])return t;try{t=pe(e)}catch(i){ee(i,r,e)}return Y[e]=t},Y={},ee=(e,r="",t="")=>{throw Object.assign(e,{message:`\u2234 ${e.message}

${r}${t?`="${t}"

`:""}`,expr:t})},F=":",K=e=>{if(!e.nodeType)return e;let r=e.content.cloneNode(!0),t=[...e.attributes],i=document.createTextNode(""),n=(r.append(i),[...r.childNodes]);return{childNodes:n,content:r,remove:()=>r.append(...n),replaceWith(o){o!==i&&(i.before(o),r.append(...n))},attributes:t,removeAttribute(o){t.splice(t.findIndex(s=>s.name===o),1)}}},w=U}}),te,xe=d({"directive/if.js"(){p(),te=Symbol("if"),h("if",(e,r)=>{let t=document.createTextNode(""),i=e.nextElementSibling,n,o,s;return e.replaceWith(t),o=e.content?K(e):e,o[m]=null,i?.hasAttribute(":else")&&(i.removeAttribute(":else"),i.hasAttribute(":if")||(i.remove(),s=i.content?K(i):i,s[m]=null)),(u,a=u?o:e[te]?null:s)=>{i&&(i[te]=a===o),n!=a&&(n&&(n.remove(),n[D]?.()),(n=a)&&(t.before(n.content||n),n[m]===null?(delete n[m],w(n,r)):n[R]()))}})}}),Ae=d({"directive/each.js"(){p(),C(),X(),h("each",(e,r,t)=>{let[i,n="$"]=t.split(/\bin\b/)[0].trim().split(/\s*,\s*/),o=document.createTextNode(""),s,u,a,y=0,g=()=>{var l,c;let b=0,v=a,O=v.length;if(s&&!s[P]){for(let x of s[j]||[])x[Symbol.dispose]();s=null,y=0}if(O<y)s.length=O;else{if(!s)s=v;else for(;b<y;)s[b]=v[b++];for(;b<O;b++){s[b]=v[b];let x=b,oe=G({[i]:s[j]?.[x]||s[x],[n]:u?u[x]:x},r),S=e.content?K(e):e.cloneNode(!0);o.before(S.content||S),w(S,oe),((c=s[l=j]||(s[l]=[]))[b]||(c[b]={}))[Symbol.dispose]=()=>{S[Symbol.dispose]?.(),S.remove()}}}y=O};return e.replaceWith(o),e[m]=null,l=>{u=null,typeof l=="number"?a=Array.from({length:l},(b,v)=>v+1):l?.constructor===Object?(u=Object.keys(l),a=Object.values(l)):a=l||[];let c=0;return k(()=>{a[P]?.value,c++||(g(),queueMicrotask(()=>(c>1&&g(),c=0)))})}},e=>q(e.split(/\bin\b/)[1]))}}),Se=d({"directive/ref.js"(){p(),C(),h("ref",(e,r,t,i,n)=>(z(r,t),n(r)==null?(Z(t)(r,e),o=>o):o=>o.call(null,e)))}}),ke=d({"directive/with.js"(){p(),C(),h("with",(e,r,t)=>(t=null,i=>w(e,t?i:t=G(i,r))))}}),Pe=d({"directive/text.js"(){p(),h("text",e=>(e.content&&e.replaceWith(e=K(e).childNodes[0]),r=>e.textContent=r??""))}}),Ne=d({"directive/class.js"(){p(),h("class",(e,r)=>(r=new Set,t=>{let i=new Set;t&&(typeof t=="string"?t.split(" ").map(n=>i.add(n)):Array.isArray(t)?t.map(n=>n&&i.add(n)):Object.entries(t).map(([n,o])=>o&&i.add(n)));for(let n of r)i.has(n)?i.delete(n):e.classList.remove(n);for(let n of r=i)e.classList.add(n)})),T.className=T.class}}),Te=d({"directive/style.js"(){p(),h("style",(e,r)=>(r=e.getAttribute("style"),t=>{if(typeof t=="string")e.setAttribute("style",r+(r.endsWith(";")?"":"; ")+t);else{r&&e.setAttribute("style",r);for(let i in t)i[0]=="-"?e.style.setProperty(i,t[i]):e.style[i]=t[i]}}))}}),ye,f,be,he,I,re,ie=d({"directive/default.js"(){p(),h("default",(e,r,t,i)=>{if(!i.startsWith("on"))return i?l=>I(e,i,l):l=>{for(let c in l)I(e,re(c),l[c])};let n=i.split("..").map(l=>{let c={evt:"",target:e,test:()=>!0};return c.evt=(l.startsWith("on")?l.slice(2):l).replace(/\.(\w+)?-?([-\w]+)?/g,(b,v,O="")=>(c.test=ye[v]?.(c,...O.split("-"))||c.test,"")),c}),o=(l,{evt:c,target:b,test:v,defer:O,stop:x,prevent:oe,immediate:S,..._e},ae)=>(O&&(l=O(l)),ae=M=>{try{v(M)&&(x&&(S?M.stopImmediatePropagation():M.stopPropagation()),oe&&M.preventDefault(),l?.call(r,M))}catch(De){ee(De,`:on${c}`,l)}},b.addEventListener(c,ae,_e),()=>b.removeEventListener(c,ae,_e));if(n.length==1)return l=>o(l,n[0]);let s,u,a,y=0,g=l=>{a=o(c=>(a(),u=l?.(c),(y=++y%n.length)?g(u):s&&g(s)),n[y])};return l=>(s=l,!a&&g(s),()=>s=null)}),ye={prevent(e){e.prevent=!0},stop(e){e.stop=!0},immediate(e){e.immediate=!0},once(e){e.once=!0},passive(e){e.passive=!0},capture(e){e.capture=!0},window(e){e.target=window},document(e){e.target=document},parent(e){e.target=e.target.parentNode},throttle(e,r=108){e.defer=t=>be(t,r)},debounce(e,r=108){e.defer=t=>he(t,r)},outside:e=>r=>{let t=e.target;return!(t.contains(r.target)||r.target.isConnected===!1||t.offsetWidth<1&&t.offsetHeight<1)},self:e=>r=>r.target===e.target,ctrl:(e,...r)=>t=>f.ctrl(t)&&r.every(i=>f[i]?f[i](t):t.key===i),shift:(e,...r)=>t=>f.shift(t)&&r.every(i=>f[i]?f[i](t):t.key===i),alt:(e,...r)=>t=>f.alt(t)&&r.every(i=>f[i]?f[i](t):t.key===i),meta:(e,...r)=>t=>f.meta(t)&&r.every(i=>f[i]?f[i](t):t.key===i),arrow:()=>f.arrow,enter:()=>f.enter,esc:()=>f.esc,tab:()=>f.tab,space:()=>f.space,delete:()=>f.delete,digit:()=>f.digit,letter:()=>f.letter,char:()=>f.char},f={ctrl:e=>e.ctrlKey||e.key==="Control"||e.key==="Ctrl",shift:e=>e.shiftKey||e.key==="Shift",alt:e=>e.altKey||e.key==="Alt",meta:e=>e.metaKey||e.key==="Meta"||e.key==="Command",arrow:e=>e.key.startsWith("Arrow"),enter:e=>e.key==="Enter",esc:e=>e.key.startsWith("Esc"),tab:e=>e.key==="Tab",space:e=>e.key==="\xA0"||e.key==="Space"||e.key===" ",delete:e=>e.key==="Delete"||e.key==="Backspace",digit:e=>/^\d$/.test(e.key),letter:e=>/^\p{L}$/gu.test(e.key),char:e=>/^\S$/.test(e.key)},be=(e,r)=>{let t,i,n=o=>{t=!0,setTimeout(()=>{if(t=!1,i)return i=!1,n(o),e(o)},r)};return o=>t?i=!0:(n(o),e(o))},he=(e,r)=>{let t;return i=>{clearTimeout(t),t=setTimeout(()=>{t=null,e(i)},r)}},I=(e,r,t)=>{t==null||t===!1?e.removeAttribute(r):e.setAttribute(r,t===!0?"":typeof t=="number"||typeof t=="string"?t:"")},re=e=>e.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,(r,t)=>(t?"-":"")+r.toLowerCase())}}),$e=d({"directive/value.js"(){p(),p(),C(),ie(),h("value",(e,r,t)=>{const i=e.type==="text"||e.type===""?n=>e.setAttribute("value",e.value=n??""):e.tagName==="TEXTAREA"||e.type==="text"||e.type===""?(n,o,s)=>(o=e.selectionStart,s=e.selectionEnd,e.setAttribute("value",e.value=n??""),o&&e.setSelectionRange(o,s)):e.type==="checkbox"?n=>(e.checked=n,I(e,"checked",n)):e.type==="select-one"?n=>{for(let o of e.options)o.value==n?o.setAttribute("selected",""):o.removeAttribute("selected");e.value=n}:e.type==="select-multiple"?n=>{for(let o of e.options)o.removeAttribute("selected");for(let o of n)e.querySelector(`[value="${o}"]`).setAttribute("selected","")}:n=>e.value=n;z(r,t);try{const n=Z(t),o=e.type==="checkbox"?()=>n(r,e.checked):e.type==="select-multiple"?()=>n(r,[...e.selectedOptions].map(s=>s.value)):()=>n(r,e.selectedIndex<0?null:e.value);e.oninput=e.onchange=o,e.type?.startsWith("select")&&(new MutationObserver(o).observe(e,{childList:!0,subtree:!0,attributes:!0}),w(e,r))}catch{}return i})}}),We=d({"directive/fx.js"(){p(),h("fx",e=>r=>r)}}),Ee=d({"directive/aria.js"(){p(),ie(),h("aria",e=>r=>{for(let t in r)I(e,"aria-"+re(t),r[t]==null?null:r[t]+"")})}}),Le=d({"directive/data.js"(){p(),h("data",e=>r=>{for(let t in r)e.dataset[t]=r[t]})}}),ne={};Oe(ne,{default:()=>me});var me,ge=d({"sprae.js"(){p(),xe(),Ae(),Se(),ke(),Pe(),Ne(),Te(),$e(),We(),ie(),Ee(),Le(),w.use({compile:e=>w.constructor(`with (arguments[0]) { return ${e} };`)}),me=w}}),se=(ge(),ue(ne)).default;if(se.use({prefix:document.currentScript.getAttribute("prefix")}),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>se()):se(),_.exports=(ge(),ue(ne)).default,typeof _.exports=="object"&&typeof $=="object"){var Ce=(e,r,t,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Object.getOwnPropertyNames(r))!Object.prototype.hasOwnProperty.call(e,n)&&n!==t&&Object.defineProperty(e,n,{get:()=>r[n],enumerable:!(i=Object.getOwnPropertyDescriptor(r,n))||i.enumerable});return e};_.exports=Ce(_.exports,$)}return _.exports});
