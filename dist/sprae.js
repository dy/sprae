var we=Object.defineProperty;var ke=(e,r)=>{for(var t in r)we(e,t,{get:r[t],enumerable:!0})};var N=Symbol.dispose||(Symbol.dispose=Symbol("dispose")),p=Symbol("state"),R=Symbol("on"),M=Symbol("off"),V=Symbol("init"),H=":",g,P,F,W=e=>e(),C=W,v={},I={},X=null,Ne=(e=document.body,r)=>{if(e[p])return Object.assign(e[p],r);r=K(r||{});let t=[],o=[];e[R]=()=>!o&&(o=t.map(i=>i())),e[M]=()=>(o?.map(i=>i()),o=null),e[N]||(e[N]=()=>(e[M](),e[M]=e[R]=e[N]=e[V]=e[p]=null));let s=e[V]=i=>{let n=i.attributes,a;if(n)for(let c=0;c<n.length;){let{name:l,value:f}=n[c];if(l.startsWith(H)){if(i.removeAttribute(l),X=l,t.push(a=ee(i,l.slice(H.length),f,r)),o.push(a()),p in i)return}else c++}for(let c of[...i.childNodes])c.nodeType==1&&s(c)};return s(e),e[p]===void 0&&(e[p]=r),r},ee,te,m=e=>{let r=Y[e=e.trim()];if(r)return r;let t=e||"undefined";/^(if|let|const)\b/.test(t)||/;(?![^{]*})/.test(t)||(t=`return ${t}`),/\bawait\s/.test(t)&&(t=`return (async()=>{ ${t} })()`);try{r=te(t)}catch(o){console.error(`\u2234 ${o}

${X}="${e}"`)}return Y[e]=function(o,s,i){try{let n=r?.call(this,o);return s?n?.then?(n.then(a=>i=s(a)),()=>typeof i=="function"&&i()):s(n):n}catch(n){console.error(`\u2234 ${n}

${X}="${e}"`)}}},Y={},Z=e=>(e.compile&&(te=e.compile),e.prefix&&(H=e.prefix),e.signal&&(g=e.signal),e.effect&&(P=e.effect),e.computed&&(F=e.computed),e.batch&&(W=e.batch),e.untracked&&(C=e.untracked),e.dir&&(ee=e.dir)),h=(e,r)=>{for(;r.length;){let[t,...o]=r.pop().split("-"),s=I[t],i;if(s&&(i=s(e,...o))!==e){for(let n in e)i[n]??(i[n]=e[n]);e=i}}return e},O=e=>{if(!e.nodeType)return e;let r=e.content.cloneNode(!0),t=[...e.attributes],o=document.createTextNode(""),s=(r.append(o),[...r.childNodes]);return{childNodes:s,content:r,remove:()=>r.append(...s),replaceWith(i){i!==o&&(o.before(i),r.append(...s))},attributes:t,removeAttribute(i){t.splice(t.findIndex(n=>n.name===i),1)}}},re=e=>e.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,(r,t)=>(t?"-":"")+r.toLowerCase()),b=(e,r,t)=>t==null||t===!1?e.removeAttribute(r):e.setAttribute(r,t===!0?"":t),z=(e,r=[])=>e?typeof e=="string"?e:(Array.isArray(e)?e.map(z):Object.entries(e).reduce((t,[o,s])=>s?[...t,o]:t,[])).join(" "):"",D=(e,r=queueMicrotask)=>{let t=0,o,s=i=>{o=i,t++||(e(o),r((n=t>1)=>(t=0,n&&s(o))))};return s},oe=(e,r=queueMicrotask,t=0)=>(o,s=++t)=>r(()=>s==t&&e(o)),d=Ne;var x=Symbol("signals"),S=Symbol("change"),Q=Symbol("set"),G=!0,T=(e,r)=>{if(!e||e[Symbol.toStringTag]||e[x])return e;if(e.constructor!==Object)return Array.isArray(e)?De(e):e;let t=Object.keys(e).length,o={},s=new Proxy(Object.assign(o,{[S]:g(t),[x]:o}),{get:(n,a)=>a in o?o[a]?o[a].valueOf():o[a]:r?r[a]:globalThis[a],set:(n,a,c,l)=>a in o?(se(o,a,c),1):(G=!1,r&&a in r?r[a]=c:(J(o,a,c),o[S].value=++t),G=!0,1),deleteProperty:(n,a)=>(a in o&&(a[0]!="_"&&o[a]?.[Symbol.dispose]?.(),delete o[a],o[S].value=--t),1),ownKeys:()=>(o[S].value,Reflect.ownKeys(o)),has:(n,a)=>a in o?!0:r?a in r:G}),i=Object.getOwnPropertyDescriptors(e);for(let n in e)i[n]?.get?(o[n]=F(i[n].get.bind(s)))[Q]=i[n].set?.bind(s):J(o,n,e[n]);return s},De=(e,r=globalThis)=>{let t=Array(e.length).fill(null),o=!1,s=a=>function(){return o=!0,a.apply(this,arguments)},i=g(e.length),n=new Proxy(Object.assign(t,{[S]:i,[x]:t,push:s(t.push),pop:s(t.pop),shift:s(t.shift),unshift:s(t.unshift),splice:s(t.splice)}),{get(a,c){return c==="length"?o?(o=!1,t.length):i.value:typeof c=="symbol"||isNaN(c)?t[c]?.valueOf()??r[c]:(t[c]??(t[c]=g(T(e[c])))).valueOf()},set(a,c,l){if(c==="length"){for(let f=l;f<t.length;f++)delete n[f];i.value=t.length=l}else c>=t.length?(J(t,c,l),n.length=+c+1):t[c]?se(t,c,l):J(t,c,l);return 1},deleteProperty:(a,c)=>(t[c]?.[Symbol.dispose]?.(),delete t[c],1)});return n},J=(e,r,t)=>e[r]=r[0]=="_"||t?.peek?t:g(T(t)),se=(e,r,t,o,s)=>r[0]==="_"?e[r]=t:t!==(s=(o=e[r]).peek())&&(o[Q]?o[Q](t):Array.isArray(t)&&Array.isArray(s)?S in s?C(()=>W(()=>{for(let i=0;i<t.length;i++)s[i]=t[i];s.length=t.length})):o.value=t:o.value=T(t)),K=T;var U={};ke(U,{batch:()=>$e,computed:()=>Te,effect:()=>ae,signal:()=>ne,untracked:()=>Ce});var w,ie=0,E,ne=(e,r,t=new Set,o=()=>r.value)=>r={get value(){return w?.deps.add(t.add(w)),e},set value(s){if(s!==e){e=s;for(let i of t)E?E.add(i):i()}},peek(){return e},toJSON:o,toString:o,valueOf:o},ae=(e,r,t,o)=>(t=s=>{let i=r;if(r=null,i?.call?.(),s=w,w=t,ie++>10)throw"Cycle detected";try{r=e()}finally{w=s,ie--}},t.fn=e,o=t.deps=new Set,t(),s=>{r?.call?.();for(s of o)s.delete(t);o.clear()}),Te=(e,r=ne(),t,o,s=()=>t.value)=>t={get value(){return o||(o=ae(()=>r.value=e())),r.value},peek:r.peek,toJSON:s,toString:s,valueOf:s},$e=(e,r=!E,t)=>{E??(E=new Set);try{e()}finally{if(r){[E,t]=[null,E];for(let o of t)o()}}},Ce=(e,r,t)=>(r=w,w=null,t=e(),w=r,t);var ce={name:"sprae",description:"DOM microhydration",version:"12.3.1",main:"./sprae.js",module:"./sprae.js","umd:main":"dist/sprae.umd.js",unpkg:"dist/sprae.umd.js",types:"dist/sprae.d.ts",type:"module",files:["core.js","sprae.js","store.js","signal.js","micro.js","directive","dist"],devDependencies:{"@preact/signals":"^2.0.4","@preact/signals-core":"^1.8.0","@webreflection/signal":"^2.1.2","es-module-shims":"^1.10.0",esbuild:"^0.23.0","esbuild-plugin-umd-wrapper":"^2.0.3","esbuild-plugin-version-injector":"^1.2.1",hyperf:"^1.7.0",jsdom:"^27.0.0",requestidlecallback:"^0.3.0","signal-polyfill":"^0.1.1",subscript:"^9.1.0",tst:"^8.0.2",ulive:"^1.0.7",usignal:"^0.9.0","wait-please":"^3.1.0"},scripts:{test:"node -r ./test/register.cjs test/test.js",build:"node .esbuild.js"},repository:{type:"git",url:"git+https://github.com/dy/sprae.git"},keywords:["hydration","progressive","progressive enhancement","signals","directives","preact-signals","reactive","template-parts","petit-vue","alpinejs","templating"],author:"Dmitry Iv <df.creative@gmail.com>",license:"MIT",bugs:{url:"https://github.com/dy/sprae/issues"},homepage:"https://github.com/dy/sprae#readme"};var le=(e,r)=>{var i;let t,o,s;return e._holder?d(o=e,r):(e[i=p]??(e[i]=null),o=e.content?O(e):e,e.replaceWith(t=document.createTextNode("")),o._holder=t._holder=t,t._clauses=[o._clause=[o,!1]],t.update=D(()=>{let n=t._clauses.find(([,a])=>a);n!=s&&(s?.[0].remove(),s?.[0][M]?.(),(s=n)&&(t.before(s[0].content||s[0]),s[0][p]?s[0][R]?.():(delete s[0][p],d(s[0],r))))})),n=>{o._clause[1]=n,o._holder.update()}};var ue=e=>{let r,t=e;for(r=e.content?O(e):e;t&&!(r._holder=t._holder);)t=t.previousSibling;return e.remove(),e[p]=null,r._holder._clauses.push(r._clause=[r,!0]),r._holder.update};var pe=e=>(e.content&&e.replaceWith(e=O(e).childNodes[0]),r=>(r=typeof r=="function"?r(e.textContent):r,e.textContent=r??""));var de=(e,r,t,o)=>{let s=new Set,i;return o.includes(".")&&(e=h({target:e},o.split(".").slice(1)).target??e),n=>{i=new Set,n&&z(typeof n=="function"?n(e.className):n).split(" ").map(a=>a&&i.add(a));for(let a of s)i.has(a)?i.delete(a):e.classList.remove(a);for(let a of s=i)e.classList.add(a)}};var fe=(e,r,t,o)=>{let s;return o.includes(".")&&(e=h({target:e},o.split(".").slice(1)).target??e),i=>{if(s||(s=e.getAttribute("style")),i=typeof i=="function"?i(e.style):i,typeof i=="string")b(e,"style",s+"; "+i);else{s&&b(e,"style",s);for(let n in i)n[0]=="-"?e.style.setProperty(n,i[n]):n[0]>"A"&&(e.style[n]=i[n])}}};var me=()=>e=>typeof e=="function"&&e();var qe=(e,r=m(`${e}=__`))=>(t,o)=>{t.__=o,r(t),delete t.__},ye=(e,r,t)=>{try{let o=qe(t),s=e.type==="checkbox"?()=>o(r,e.checked):e.type==="select-multiple"?()=>o(r,[...e.selectedOptions].map(i=>i.value)):()=>o(r,e.selectedIndex<0?null:isNaN(e.valueAsNumber)?e.value:e.valueAsNumber);e.oninput=e.onchange=s,e.type?.startsWith("select")&&(new MutationObserver(s).observe(e,{childList:!0,subtree:!0,attributes:!0}),d(e,r)),m(t)(r)??s()}catch{}return e.type==="text"||e.type===""||e.tagName==="TEXTAREA"?(o,s,i)=>(s=e.selectionStart,i=e.selectionEnd,e.setAttribute("value",e.value=o??""),s&&e.setSelectionRange(s,i)):e.type==="checkbox"?o=>(e.checked=o,b(e,"checked",o)):e.type==="radio"?o=>e.value===o&&(e.checked=o,b(e,"checked",o)):e.type==="select-one"?o=>{for(let s of e.options)s.value==o?s.setAttribute("selected",""):s.removeAttribute("selected");e.value=o}:e.type==="select-multiple"?o=>{for(let s of e.options)s.removeAttribute("selected");for(let s of o)e.querySelector(`[value="${s}"]`).setAttribute("selected","")}:o=>e.value=o};var ge=(e,r,t)=>{let o=m(t)(r);if(typeof o=="function")return{[Symbol.dispose]:o(e)};Object.defineProperty(r,t,{value:e,configurable:!0})};var he=(e,r)=>{let t=e[p]=T({},r),o=!1;return s=>{if(s=typeof s=="function"?s(t):s,s!==t)for(let i in s){let n=typeof s[i]=="function"?s[i].bind(t):s[i];i in t[x]?t[i]=n:t[x][i]=i[0]=="_"||n?.peek?n:g(T(n))}return!o&&(o=!0,delete e[p],C(()=>d(e,t)))}};var be=(e,r,t)=>{let[o,s]=t.split(/\bin\b/),[i,n="$"]=o.trim().replace(/\(|\)/g,"").split(/\s*,\s*/),a=document.createTextNode(""),c,l,f,j=0,_=D(()=>{var A,$;let u=0,k=f,y=k.length;if(c&&!c[S]){for(let q of c[x]||[])q[Symbol.dispose]();c=null,j=0}if(y<j)c.length=y;else{if(!c)c=k;else for(;u<j;)c[u]=k[u++];for(;u<y;u++){c[u]=k[u];let q=u,Ae=Object.create(r,{[i]:{get:()=>c[q]},[n]:{value:l?l[q]:q}}),L=e.content?O(e):e.cloneNode(!0);a.before(L.content||L),d(L,Ae);let Oe=(($=c[A=x]||(c[A]=[]))[u]||($[u]={}))[Symbol.dispose];c[x][u][Symbol.dispose]=()=>{Oe?.(),L[Symbol.dispose]?.(),L.remove()}}}j=y});return e.replaceWith(a),e[p]=null,Object.assign(u=>(l=null,typeof u=="number"?f=Array.from({length:u},(k,y)=>y+1):u?.constructor===Object?(l=Object.keys(u),f=Object.values(u)):f=u||[],P(()=>{f[S]?.value,_()})),{eval:m(s)})};var xe=(e,r,t,o)=>s=>b(e,o,typeof s=="function"?s(e.getAttribute(o)):s);var _e=e=>r=>{for(let t in r)b(e,re(t),r[t])};var Se=(e,r,t,o)=>{let[s,...i]=o.slice(2).split("."),n=m(t).bind(e),a=h(Object.assign(c=>n(r,l=>typeof l=="function"?l(c):l),{target:e}),i);return a.target.addEventListener(s,a,a),{[Symbol.dispose](){a.target.removeEventListener(s,a)}}};var je=(e,r,t,o)=>{let s,i,n=o.split("..").map((a,c,{length:l})=>a.split(":").reduce((f,j)=>{let[_,...u]=j.slice(2).split("."),k=m(t).bind(e),y=h(Object.assign(A=>(c?s=s(A):k(r,$=>s=typeof $=="function"?$(A):$),i(),i=n[(c+1)%l]()),{target:e}),u);return A=>(A=f?.(),y.target.addEventListener(_,y,y),()=>(A?.(),y.target.removeEventListener(_,y)))},null));return i=n[0](),{[Symbol.dispose](){i?.()}}};Object.assign(v,{_:(e,r,t,o)=>(o.startsWith("on")?Se:xe)(e,r,t,o),"":_e,class:de,text:pe,style:fe,fx:me,value:ye,ref:ge,scope:he,if:le,else:ue,each:be});var Le=(e,r,t,o)=>{let[s,...i]=r.split("."),n=v[s]||v._;return()=>{let a=n(e,o,t,r);if(!a?.call)return a?.[N];let c=h(Object.assign(D(()=>l.value++),{target:e}),i),l=g(0),f=0,j=a.eval??m(t).bind(e),_,u=()=>(typeof _=="function"&&_(),_=null);return o=e[p]??o,P(()=>(l.value==f?c():(f=l.value,_=j(o,a)),u))}};Object.assign(I,{debounce:(e,r)=>oe(e,(r||(r=0),r?r==="raf"?requestAnimationFrame:t=>setTimeout(t,r):void 0)),throttle:(e,r)=>D(e,(r||(r=0),r?r==="raf"?requestAnimationFrame:t=>setTimeout(t,r):void 0)),delay:(e,r)=>r?t=>setTimeout(()=>e(t),r):t=>queueMicrotask(()=>e(t)),tick:e=>(console.warn("Deprecated"),r=>queueMicrotask(()=>e(r))),raf:e=>(console.warn("Deprecated"),r=>requestAnimationFrame(()=>e(r))),once:(e,r,t)=>(t=o=>!r&&(r=1,e(o)),t.once=!0,t),window:e=>(e.target=e.target.ownerDocument.defaultView,e),document:e=>(e.target=e.target.ownerDocument,e),root:e=>(e.target=e.target.ownerDocument.documentElement,e),body:e=>(e.target=e.target.ownerDocument.body,e),parent:e=>(e.target=e.target.parentNode,e),self:e=>r=>r.target===e.target&&e(r),outside:e=>(r,t)=>(t=e.target,!t.contains(r.target)&&r.target.isConnected&&(t.offsetWidth||t.offsetHeight)),prevent:e=>r=>(r?.preventDefault(),e(r)),stop:(e,r)=>t=>(r?.[0]==="i"?t?.stopImmediatePropagation():t?.stopPropagation(),e(t)),immediate:e=>(console.warn("Deprecated"),r=>(r?.stopImmediatePropagation(),e(r))),passive:e=>(e.passive=!0,e),capture:e=>(e.capture=!0,e)});var B={ctrl:e=>e.ctrlKey||e.key==="Control"||e.key==="Ctrl",shift:e=>e.shiftKey||e.key==="Shift",alt:e=>e.altKey||e.key==="Alt",meta:e=>e.metaKey||e.key==="Meta",cmd:e=>e.metaKey||e.key==="Command",arrow:e=>e.key.startsWith("Arrow"),enter:e=>e.key==="Enter",esc:e=>e.key.startsWith("Esc"),tab:e=>e.key==="Tab",space:e=>e.key==="\xA0"||e.key==="Space"||e.key===" ",delete:e=>e.key==="Delete"||e.key==="Backspace",digit:e=>/^\d$/.test(e.key),letter:e=>/^\p{L}$/gu.test(e.key),char:e=>/^\S$/.test(e.key)};for(let e in B)I[e]=(r,t,o)=>s=>B[e](s)&&(!t||B[t]?.(s))&&(!o||B[o]?.(s))&&r(s);Z({compile:e=>d.constructor(`with (arguments[0]) { ${e} }`),dir:(e,r,t,o)=>r.includes("..")?()=>je(e,o,t,r)[N]:r.split(":").reduce((s,i)=>{let n=Le(e,i,t,o);return s?(a,c)=>(a=s(),c=n(),()=>{a(),c()}):n},null),...U});d.use=Z;d.store=K;d.directive=v;d.modifier=I;d.version=ce.version;var Ft=d.start=(e=document.body,r)=>{let t=K(r);return d(e,t),new MutationObserver(s=>{for(let i of s)for(let n of i.addedNodes)n.nodeType===1&&n[p]===void 0&&e.contains(n)&&e[V](n)}).observe(e,{childList:!0,subtree:!0}),t};d.version="12.3.1";var Jt=d;export{W as batch,F as computed,Jt as default,P as effect,g as signal,d as sprae,Ft as start,K as store,C as untracked,Z as use};
