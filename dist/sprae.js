var ne={name:"sprae",description:"DOM microhydration",version:"12.2.3",main:"./sprae.js",module:"./sprae.js","umd:main":"dist/sprae.umd.js",unpkg:"dist/sprae.umd.js",types:"dist/sprae.d.ts",type:"module",files:["core.js","sprae.js","store.js","signal.js","micro.js","directive","dist"],devDependencies:{"@preact/signals":"^2.0.4","@preact/signals-core":"^1.8.0","@webreflection/signal":"^2.1.2","es-module-shims":"^1.10.0",esbuild:"^0.23.0","esbuild-plugin-umd-wrapper":"^2.0.3",hyperf:"^1.7.0",jsdom:"^27.0.0",requestidlecallback:"^0.3.0","signal-polyfill":"^0.1.1",subscript:"^9.1.0",tst:"^7.2.0",ulive:"^1.0.7",usignal:"^0.9.0","wait-please":"^3.1.0"},scripts:{test:"node -r ./test/register.cjs test/test.js",build:"node .esbuild.js"},repository:{type:"git",url:"git+https://github.com/dy/sprae.git"},keywords:["hydration","progressive","progressive enhancement","signals","directives","preact-signals","reactive","template-parts","petit-vue","alpinejs","templating"],author:"Dmitry Iv <df.creative@gmail.com>",license:"MIT",bugs:{url:"https://github.com/dy/sprae/issues"},homepage:"https://github.com/dy/sprae#readme"};var J=Symbol.dispose||(Symbol.dispose=Symbol("dispose")),u=Symbol("state"),H=Symbol("on"),K=Symbol("off"),G=Symbol("init"),q=":",A,v,U,X=e=>e(),R=X,W={},V={},Q=null,Y=(e=document.body,r)=>{if(e[u])return Object.assign(e[u],r);r=F(r||{});let t=[],o=[];e[H]=()=>!o&&(o=t.map(i=>i())),e[K]=()=>(o?.map(i=>i()),o=null),e[J]||(e[J]=()=>(e[K](),e[K]=e[H]=e[J]=e[G]=e[u]=null));let s=e[G]=i=>{let n=i.attributes,a;if(n)for(let c=0;c<n.length;){let{name:p,value:y}=n[c];if(p.startsWith(q)){if(i.removeAttribute(p),(a=Me(i,p,y,r))&&(t.push(a),o.push(a())),u in i)return}else c++}for(let c of[...i.childNodes])c.nodeType==1&&s(c)};return s(e),e[u]===void 0&&(e[u]=r),r};Y.version=ne.version;var Me=(e,r,t,o)=>{let s,i,n=r.slice(q.length).split("..").map((a,c,{length:p})=>a.split(q).reduce((y,l)=>{let[m,...g]=l.split("."),D=S(t,W[Q=m]?.parse);if(m.startsWith("on")){let L=m.slice(2),I=ae(B(p==1?P=>D(o,z=>d(z,P)):P=>(s=(c?s:z=>d(D(o),z))(P),i(),i=n[(c+1)%p]()),{target:e}),g);return P=>(P=y?.(),I.target.addEventListener(L,I,I),()=>(P?.(),I.target.removeEventListener(L,I)))}let k,h,w,b;g.length?(w=A(-1),b=-1,k=ae(B(T(()=>{++w.value||(h=v(()=>M&&(w.value==b?k():(b=w.value,D(o,M)))))}),{target:e}),g)):k=B(()=>h=v(()=>D(o,M)),{target:e});let M=(W[m]||W["*"])(k.target,o,t,m);if(M)return e[u]&&(o=e[u]),L=>(L=y?.(),k(),()=>(L?.(),h?.(),w&&(w.value=-1,b=h=null)))},null));return()=>i=n[0]?.()},_=e=>(e.compile&&(le=e.compile),e.prefix&&(q=e.prefix),e.signal&&(A=e.signal),e.effect&&(v=e.effect),e.computed&&(U=e.computed),e.batch&&(X=e.batch),e.untracked&&(R=e.untracked)),ce=(e=document.body,r)=>{let t=F(r);return Y(e,t),new MutationObserver(s=>{for(let i of s)for(let n of i.addedNodes)n.nodeType===1&&n[u]===void 0&&e.contains(n)&&e[G](n)}).observe(e,{childList:!0,subtree:!0}),t},le,S=(e,r,t)=>{if(t=S.cache[e])return t;let o=e.trim()||"undefined";r&&(o=r(o)),/^(if|let|const)\b/.test(o)||/;(?![^{]*})/.test(o)||(o=`return ${o}`),/\bawait\s/.test(o)&&(o=`return (async()=>{ ${o} })()`);try{t=le(o),Object.defineProperty(t,"name",{value:`\u2234 ${e}`})}catch(s){console.error(`\u2234 ${s}

${q+Q}="${e}"`)}return S.cache[e]=(s,i,n)=>{try{let a=t?.(s);return i?(a?.then?a.then(c=>n=i(c)):n=i(a),()=>d(n)):a}catch(a){console.error(`\u2234 ${a}

${q+Q}="${e}"`)}}};S.cache={};var ae=(e,r)=>{for(;r.length;){let[t,...o]=r.pop().split("-");e=B(V[t]?.(e,...o)??e,e)}return e},B=(e,r)=>{if(e!=r)for(let t in r)e[t]??(e[t]=r[t]);return e},N=e=>{if(!e.nodeType)return e;let r=e.content.cloneNode(!0),t=[...e.attributes],o=document.createTextNode(""),s=(r.append(o),[...r.childNodes]);return{childNodes:s,content:r,remove:()=>r.append(...s),replaceWith(i){i!==o&&(o.before(i),r.append(...s))},attributes:t,removeAttribute(i){t.splice(t.findIndex(n=>n.name===i),1)}}},d=(e,r)=>typeof e=="function"?e(r):e,ue=e=>e.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,(r,t)=>(t?"-":"")+r.toLowerCase()),x=(e,r,t)=>t==null||t===!1?e.removeAttribute(r):e.setAttribute(r,t===!0?"":t),ee=(e,r=[])=>e?typeof e=="string"?e:(Array.isArray(e)?e.map(ee):Object.entries(e).reduce((t,[o,s])=>s?[...t,o]:t,[])).join(" "):"",T=(e,r=queueMicrotask)=>{let t=0,o=s=>{t++||(e(s),r((i=t>1)=>(t=0,i&&o(s))))};return o},pe=(e,r=queueMicrotask,t=0)=>(o,s=++t)=>r(()=>s==t&&e(o)),f=Y;var j=Symbol("signals"),O=Symbol("change"),re=Symbol("set"),te=!0,C=(e,r)=>{if(!e||e[Symbol.toStringTag]||e[j])return e;if(e.constructor!==Object)return Array.isArray(e)?Pe(e):e;let t=Object.keys(e).length,o={},s=new Proxy(Object.assign(o,{[O]:A(t),[j]:o}),{get:(n,a)=>a in o?o[a]?o[a].valueOf():o[a]:r?r[a]:globalThis[a],set:(n,a,c,p)=>a in o?(fe(o,a,c),1):(te=!1,r&&a in r?r[a]=c:(Z(o,a,c),o[O].value=++t),te=!0,1),deleteProperty:(n,a)=>(a in o&&(a[0]!="_"&&o[a]?.[Symbol.dispose]?.(),delete o[a],o[O].value=--t),1),ownKeys:()=>(o[O].value,Reflect.ownKeys(o)),has:(n,a)=>a in o?!0:r?a in r:te}),i=Object.getOwnPropertyDescriptors(e);for(let n in e)i[n]?.get?(o[n]=U(i[n].get.bind(s)))[re]=i[n].set?.bind(s):Z(o,n,e[n]);return s},Pe=(e,r=globalThis)=>{let t=Array(e.length).fill(null),o=!1,s=a=>function(){return o=!0,a.apply(this,arguments)},i=A(e.length),n=new Proxy(Object.assign(t,{[O]:i,[j]:t,push:s(t.push),pop:s(t.pop),shift:s(t.shift),unshift:s(t.unshift),splice:s(t.splice)}),{get(a,c){return c==="length"?o?(o=!1,t.length):i.value:typeof c=="symbol"||isNaN(c)?t[c]?.valueOf()??r[c]:(t[c]??(t[c]=A(C(e[c])))).valueOf()},set(a,c,p){if(c==="length"){for(let y=p;y<t.length;y++)delete n[y];i.value=t.length=p}else c>=t.length?(Z(t,c,p),n.length=+c+1):t[c]?fe(t,c,p):Z(t,c,p);return 1},deleteProperty:(a,c)=>(t[c]?.[Symbol.dispose]?.(),delete t[c],1)});return n},Z=(e,r,t)=>e[r]=r[0]=="_"||t?.peek?t:A(C(t)),fe=(e,r,t,o,s)=>r[0]==="_"?e[r]=t:t!==(s=(o=e[r]).peek())&&(o[re]?o[re](t):Array.isArray(t)&&Array.isArray(s)?O in s?R(()=>X(()=>{for(let i=0;i<t.length;i++)s[i]=t[i];s.length=t.length})):o.value=t:o.value=C(t)),F=C;var $,de=0,E,oe=(e,r,t=new Set,o=()=>r.value)=>r={get value(){return $?.deps.push(t.add($)),e},set value(s){if(s!==e){e=s;for(let i of t)E?E.add(i):i()}},peek(){return e},toJSON:o,then:o,toString:o,valueOf:o},se=(e,r,t,o,s)=>(t=i=>{if(s=r,r=null,s?.call?.(),i=$,$=t,de++>10)throw"Cycle detected";try{r=e()}finally{$=i,de--}},o=t.deps=[],t(),i=>{for(r?.call?.();i=o.pop();)i.delete(t)}),me=(e,r=oe(),t,o,s=()=>t.value)=>t={get value(){return o||(o=se(()=>r.value=e())),r.value},peek:r.peek,toJSON:s,then:s,toString:s,valueOf:s},ye=(e,r=!E)=>{E??(E=new Set);try{e()}finally{if(r){for(let t of E)t();E=null}}},ge=(e,r,t)=>(r=$,$=null,t=e(),$=r,t);var he=(e,r,t,o,s)=>{var i;return e._holder?f(o=e,r):(e[i=u]??(e[i]=null),o=e.content?N(e):e,e.replaceWith(t=document.createTextNode("")),o._holder=t._holder=t,t._clauses=[o._clause=[o,!1]],t.update=T(()=>{let n=t._clauses.find(([,a])=>a);n!=s&&(s?.[0].remove(),s?.[0][K]?.(),(s=n)&&(t.before(s[0].content||s[0]),s[0][u]?s[0][H]?.():(delete s[0][u],f(s[0],r))))})),n=>{o._clause[1]=n,o._holder.update()}};var be=(e,r,t,o,s=e)=>{for(t=e.content?N(e):e;s&&!(t._holder=s._holder);)s=s.previousSibling;return e.remove(),e[u]=null,t._holder._clauses.push(t._clause=[t,!0]),t._holder.update};var xe=e=>(e.content&&e.replaceWith(e=N(e).childNodes[0]),r=>(r=d(r,e.textContent),e.textContent=r??""));var je=(e,r,t)=>(r=new Set,o=>{t=new Set,o&&ee(d(o,e.className)).split(" ").map(s=>s&&t.add(s));for(let s of r)t.has(s)?t.delete(s):e.classList.remove(s);for(let s of r=t)e.classList.add(s)});var Se=(e,r)=>(r=e.getAttribute("style"),t=>{if(t=d(t,e.style),typeof t=="string")x(e,"style",r+"; "+t);else{r&&x(e,"style",r);for(let o in t)o[0]=="-"?e.style.setProperty(o,t[o]):o[0]>"A"&&(e.style[o]=t[o])}});var Ae=()=>d;var We=(e,r=S(`${e}=__`))=>(t,o)=>{t.__=o,r(t),delete t.__},Oe=(e,r,t,o)=>{try{let s=We(t),i=e.type==="checkbox"?()=>s(r,e.checked):e.type==="select-multiple"?()=>s(r,[...e.selectedOptions].map(n=>n.value)):()=>s(r,e.selectedIndex<0?null:isNaN(e.valueAsNumber)?e.value:e.valueAsNumber);e.oninput=e.onchange=i,e.type?.startsWith("select")&&(new MutationObserver(i).observe(e,{childList:!0,subtree:!0,attributes:!0}),f(e,r)),S(t)(r)??i()}catch{}return e.type==="text"||e.type===""||e.tagName==="TEXTAREA"?(s,i,n)=>(i=e.selectionStart,n=e.selectionEnd,e.setAttribute("value",e.value=s??""),i&&e.setSelectionRange(i,n)):e.type==="checkbox"?s=>(e.checked=s,x(e,"checked",s)):e.type==="radio"?s=>e.value===s&&(e.checked=s,x(e,"checked",s)):e.type==="select-one"?s=>{for(let i of e.options)i.value==s?i.setAttribute("selected",""):i.removeAttribute("selected");e.value=s}:e.type==="select-multiple"?s=>{for(let i of e.options)i.removeAttribute("selected");for(let i of s)e.querySelector(`[value="${i}"]`).setAttribute("selected","")}:s=>e.value=s};var ke=(e,r,t,o,s,i)=>{if(typeof S(t)(r)=="function")return n=>n(e);Object.defineProperty(r,t,{value:e,configurable:!0})};var we=(e,r)=>{let t=e[u]=C({},r),o=!1;return s=>{if(s=d(s,t),s!==t)for(let i in s){let n=typeof s[i]=="function"?s[i].bind(t):s[i];i in t[j]?t[i]=n:t[j][i]=i[0]=="_"||n?.peek?n:A(C(n))}return!o&&(o=!0,delete e[u],R(()=>f(e,t)))}};var Ne=(e,r,t)=>{let[o,s="$"]=t.split(/\bin\b/)[0].trim().replace(/\(|\)/g,"").split(/\s*,\s*/),i=document.createTextNode(""),n,a,c,p=0,y=T(()=>{var D,k;let l=0,m=c,g=m.length;if(n&&!n[O]){for(let h of n[j]||[])h[Symbol.dispose]();n=null,p=0}if(g<p)n.length=g;else{if(!n)n=m;else for(;l<p;)n[l]=m[l++];for(;l<g;l++){n[l]=m[l];let h=l,w=Object.create(r,{[o]:{get:()=>n[h]},[s]:{value:a?a[h]:h}}),b=e.content?N(e):e.cloneNode(!0);i.before(b.content||b),f(b,w);let M=((k=n[D=j]||(n[D]=[]))[l]||(k[l]={}))[Symbol.dispose];n[j][l][Symbol.dispose]=()=>{M?.(),b[Symbol.dispose]?.(),b.remove()}}}p=g});return e.replaceWith(i),e[u]=null,l=>(a=null,typeof l=="number"?c=Array.from({length:l},(m,g)=>g+1):l?.constructor===Object?(a=Object.keys(l),c=Object.values(l)):c=l||[],v(()=>{c[O]?.value,y()}))};Ne.parse=e=>e.split(/\bin\b/)[1].trim();var $e=Ne;var De=(e,r,t,o)=>s=>x(e,o,d(s,e.getAttribute(o)));var Te=e=>r=>{for(let t in r)x(e,ue(t),r[t])};Object.assign(W,{"*":De,"":Te,class:je,text:xe,style:Se,fx:Ae,value:Oe,ref:ke,scope:we,if:he,else:be,each:$e});Object.assign(V,{debounce:(e,r=250,t=r==="tick"?queueMicrotask:r==="raf"?requestAnimationFrame:r==="idle"?requestIdleCallback:s=>setTimeout(s,r),o=0)=>pe(e,t),throttle:(e,r=250,t=r==="tick"?queueMicrotask:r==="raf"?requestAnimationFrame:o=>setTimeout(o,r))=>T(e,t),once:(e,r,t)=>Object.assign(o=>!r&&(r=1,e(o)),{once:!0}),prevent:e=>r=>(r?.preventDefault(),e(r)),stop:e=>r=>(r?.stopPropagation(),e(r)),immediate:e=>r=>(r?.stopImmediatePropagation(),e(r)),passive:e=>(e.passive=!0,e),capture:e=>(e.capture=!0,e),window:e=>(e.target=e.target.ownerDocument.defaultView,e),document:e=>(e.target=e.target.ownerDocument,e),root:e=>(e.target=e.target.ownerDocument.documentElement,e),body:e=>(e.target=e.target.ownerDocument.body,e),parent:e=>(e.target=e.target.parentNode,e),self:e=>r=>r.target===e.target&&e(r),outside:e=>(r,t)=>(t=e.target,!t.contains(r.target)&&r.target.isConnected&&(t.offsetWidth||t.offsetHeight))});var ie={ctrl:e=>e.ctrlKey||e.key==="Control"||e.key==="Ctrl",shift:e=>e.shiftKey||e.key==="Shift",alt:e=>e.altKey||e.key==="Alt",meta:e=>e.metaKey||e.key==="Meta"||e.key==="Command",arrow:e=>e.key.startsWith("Arrow"),enter:e=>e.key==="Enter",esc:e=>e.key.startsWith("Esc"),tab:e=>e.key==="Tab",space:e=>e.key==="\xA0"||e.key==="Space"||e.key===" ",delete:e=>e.key==="Delete"||e.key==="Backspace",digit:e=>/^\d$/.test(e.key),letter:e=>/^\p{L}$/gu.test(e.key),char:e=>/^\S$/.test(e.key)};for(let e in ie)V[e]=(r,...t)=>o=>ie[e](o)&&t.every(s=>ie[s]?.(o)??o.key===s)&&r(o);_({compile:e=>f.constructor(`with (arguments[0]) { ${e} }`),signal:oe,effect:se,computed:me,batch:ye,untracked:ge});f.use=_;f.store=F;f.directive=W;f.modifier=V;f.start=ce;var It=f;export{ye as batch,me as computed,It as default,se as effect,oe as signal,f as sprae,ce as start,F as store,ge as untracked,_ as use};
