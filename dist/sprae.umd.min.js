(function (g, f) {if ("object" == typeof exports && "object" == typeof module) {module.exports = f();} else if ("function" == typeof define && define.amd) {define("sprae", [], f);} else if ("object" == typeof exports) {exports["sprae"] = f();} else {g["sprae"] = f();}}(typeof self !== 'undefined' ? self : typeof globalThis !== 'undefined' ? globalThis : this, () => {var exports = {};var module = { exports };
var U=Object.defineProperty;var Y=(e,o)=>{for(var t in o)U(e,t,{get:o[t],enumerable:!0})};var E,p,T,P,j;function B(e){E=e.signal,p=e.effect,j=e.computed,P=e.batch||(o=>o()),T=e.untracked||P}var x=Symbol("signals"),O=Symbol("length");function v(e,o){if(!e||e[x])return e;if(Array.isArray(e))return te(e);if(e.constructor!==Object)return e;let t={...o?.[x]},r=E(Object.values(e).length),s=new Proxy(t,{get:(i,n)=>n===O?r:n===x?t:t[n]?.valueOf(),set:(i,n,c,a)=>(a=t[n],I(t,n,c),a??++r.value,1),deleteProperty:(i,n)=>(t[n]&&(H(t,n),r.value--),1),ownKeys(){return r.value,Reflect.ownKeys(t)}});for(let i in e){let n=Object.getOwnPropertyDescriptor(e,i);n?.get?(t[i]=j(n.get.bind(s)))._set=n.set?.bind(s):(t[i]=void 0,I(t,i,e[i]))}return s}var ee={push:1,pop:1,shift:1,unshift:1,splice:1};function te(e){let o;if(e[x])return e;let t=E(e.length),r=Array(e.length).fill(),s=new Proxy(r,{get(i,n){if(typeof n=="symbol")return n===O?t:n===x?r:r[n];if(n==="length")return ee[o]?t.peek():t.value;if(o=n,r[n])return r[n].valueOf();if(n<r.length)return(r[n]=E(v(e[n]))).value},set(i,n,c){if(n==="length"){for(let a=c,y=r.length;a<y;a++)delete s[a];return t.value=r.length=c,!0}return I(r,n,c),n>=t.peek()&&(t.value=r.length=Number(n)+1),!0},deleteProperty:(i,n)=>(r[n]&&H(r,n),1)});return s}function I(e,o,t){let r=e[o];if(o[0]==="_")e[o]=t;else if(!r)e[o]=r=t?.peek?t:E(v(t));else if(t!==r.peek())if(r._set)r._set(t);else if(Array.isArray(t)&&Array.isArray(r.peek())){let s=r.peek();s[O]?T(()=>{P(()=>{let i=0,n=t.length;for(;i<n;i++)s[i]=t[i];s.length=n})}):r.value=t}else r.value=v(t)}function H(e,o){let t=e[o],r=t[Symbol.dispose];r&&delete t[Symbol.dispose],delete e[o],r?.()}var M=Symbol.dispose||(Symbol.dispose=Symbol("dispose")),u={},g=new WeakMap;function d(e,o){if(!e?.childNodes)return;if(g.has(e))return Object.assign(g.get(e),o);let t=v(o||{}),r=[];return s(e),g.has(e)||g.set(e,t),e[M]=()=>{for(;r.length;)r.pop()();g.delete(e)},t;function s(i,n=i.parentNode){if(!!i.childNodes){for(let c=0;c<i.attributes?.length;){let a=i.attributes[c];if(a.name[0]===":"){i.removeAttribute(a.name);let y=a.name.slice(1).split(":");for(let A of y){let f=u[A]||u.default,l=(f.parse||W)(a.value),h=f(i,l,t,A);h&&r.push(h)}if(g.has(i))return i[M]&&r.push(i[M]);if(i.parentNode!==n)return}else c++}for(let c of[...i.childNodes])s(c,i)}}}var V={},W=(e,o,t)=>{if(t=V[e=e.trim()])return t;try{t=X(e)}catch(r){R(r,o,e)}return V[e]=t},R=(e,o,t="")=>{throw Object.assign(e,{message:`\u2234 ${e.message}

${o}${t?`="${t}"

`:""}`,expr:t})},X;d.use=e=>{e.signal&&B(e),e.compile&&(X=e.compile)};var N=e=>{if(!e.nodeType)return e;let o=e.content.cloneNode(!0),t=[...e.attributes],r=document.createTextNode(""),s=(o.append(r),[...o.childNodes]);return{childNodes:s,content:o,remove:()=>o.append(...s),replaceWith(i){i!==r&&(r.before(i),o.append(...s))},attributes:t,removeAttribute(i){t.splice(t.findIndex(n=>n.name===i),1)}}};var F={};Y(F,{batch:()=>oe,computed:()=>re,effect:()=>z,signal:()=>Z,untracked:()=>ne});var w,$,Z=(e,o,t=new Set)=>(o={get value(){return w?.deps.push(t.add(w)),e},set value(r){if(r!==e){e=r;for(let s of t)$?$.add(s):s()}},peek(){return e}},o.toJSON=o.then=o.toString=o.valueOf=()=>o.value,o),z=(e,o,t,r)=>(t=s=>{o?.call?.(),s=w,w=t;try{o=e()}finally{w=s}},r=t.deps=[],t(),s=>{for(o?.call?.();s=r.pop();)s.delete(t)}),re=(e,o=Z(),t,r)=>(t={get value(){return r||(r=z(()=>o.value=e())),o.value},peek:o.peek},t.toJSON=t.then=t.toString=t.valueOf=()=>t.value,t),oe=e=>{let o=$;o||($=new Set);try{e()}finally{if(!o){o=$,$=null;for(let t of o)t()}}},ne=(e,o,t)=>(o=w,w=null,t=e(),w=o,t);var G=Symbol("if");u.if=(e,o,t)=>{let r=e.nextElementSibling,s=document.createTextNode(""),i,n,c;return e.replaceWith(s),n=e.content?N(e):e,g.set(n,null),r?.hasAttribute(":else")&&(r.removeAttribute(":else"),r.hasAttribute(":if")||(r.remove(),c=r.content?N(r):r,g.set(c,null))),p(()=>{let a=o(t)?n:e[G]?null:c;r&&(r[G]=a===n),i!=a&&(i?.remove(),(i=a)&&(s.before(i.content||i),g.get(i)===null&&g.delete(i),d(i,t)))})};u.each=(e,[o,t,r],s)=>{let i=document.createTextNode("");e.replaceWith(i);let n,c,a=0,y=j(()=>{c=null;let l=r(s);return typeof l=="number"&&(l=Array.from({length:l},(h,b)=>b+1)),l?.constructor===Object&&(c=Object.keys(l),l=Object.values(l)),l||[]}),A=()=>{T(()=>{var S,C;let l=0,h=y.value,b=h.length;if(n&&!n[O]){for(let k of n[x]||[])k[Symbol.dispose]();n=null,a=0}if(b<a)n.length=b;else{if(!n)n=h;else for(;l<a;l++)n[l]=h[l];for(;l<b;l++){n[l]=h[l];let k=l,K=v({[o]:n[x]?.[k]||n[k],[t]:c?c[k]:k},s),_=e.content?N(e):e.cloneNode(!0);i.before(_.content||_),d(_,K),((C=n[S=x]||(n[S]=[]))[l]||(C[l]={}))[Symbol.dispose]=()=>{_[Symbol.dispose](),_.remove()}}}a=b})},f=0;return p(()=>{y.value[O]?.value,f?f++:(A(),queueMicrotask(()=>(f&&A(),f=0)))})};u.each.parse=e=>{let[o,t]=e.split(/\s+in\s+/),[r,s="$"]=o.split(/\s*,\s*/);return[r,s,W(t)]};u.ref=(e,o,t)=>{t[o]=e};u.ref.parse=e=>e;u.with=(e,o,t)=>{let r;return p(()=>{let s=o(t);d(e,r?s:r=v(s,t))})};u.html=(e,o,t)=>{let r=o(t);if(!r)return;let s=(r.content||r).cloneNode(!0);e.replaceChildren(s),d(e,t)};u.text=(e,o,t)=>(e.content&&e.replaceWith(e=N(e).childNodes[0]),p(()=>{let r=o(t);e.textContent=r??""}));u.class=(e,o,t)=>{let r=new Set;return p(()=>{let s=o(t),i=new Set;s&&(typeof s=="string"?s.split(" ").map(n=>i.add(n)):Array.isArray(s)?s.map(n=>n&&i.add(n)):Object.entries(s).map(([n,c])=>c&&i.add(n)));for(let n of r)i.has(n)?i.delete(n):e.classList.remove(n);for(let n of r=i)e.classList.add(n)})};u.style=(e,o,t)=>{let r=e.getAttribute("style");return p(()=>{let s=o(t);if(typeof s=="string")e.setAttribute("style",r+(r.endsWith(";")?"":"; ")+s);else{r&&e.setAttribute("style",r);for(let i in s)i[0]=="-"?e.style.setProperty(i,s[i]):e.style[i]=s[i]}})};u.default=(e,o,t,r)=>{if(!r.startsWith("on"))return p(()=>{let f=o(t);if(r)D(e,r,f);else for(let l in f)D(e,ce(l),f[l])});let s=r.split("..").map(f=>{let l={evt:"",target:e,test:()=>!0};return l.evt=(f.startsWith("on")?f.slice(2):f).replace(/\.(\w+)?-?([-\w]+)?/g,(h,b,S="")=>(l.test=ie[b]?.(l,...S.split("-"))||l.test,"")),l});if(s.length==1)return p(()=>A(o(t),s[0]));let i,n,c,a=0,y=f=>{c=A(l=>(c(),n=f?.(l),(a=++a%s.length)?y(n):i&&y(i)),s[a])};return p(()=>(i=o(t),!c&&y(i),()=>i=null));function A(f,{evt:l,target:h,test:b,defer:S,stop:C,prevent:k,immediate:K,..._}){S&&(f=S(f));let q=L=>{try{b(L)&&(C&&(K?L.stopImmediatePropagation():L.stopPropagation()),k&&L.preventDefault(),f?.(L))}catch(Q){R(Q,`:on${l}`,f)}};return h.addEventListener(l,q,_),()=>h.removeEventListener(l,q,_)}};var ie={prevent(e){e.prevent=!0},stop(e){e.stop=!0},immediate(e){e.immediate=!0},once(e){e.once=!0},passive(e){e.passive=!0},capture(e){e.capture=!0},window(e){e.target=window},document(e){e.target=document},throttle(e,o){e.defer=t=>se(t,o?Number(o)||0:108)},debounce(e,o){e.defer=t=>le(t,o?Number(o)||0:108)},outside:e=>o=>{let t=e.target;return!(t.contains(o.target)||o.target.isConnected===!1||t.offsetWidth<1&&t.offsetHeight<1)},self:e=>o=>o.target===e.target,ctrl:(e,...o)=>t=>m.ctrl(t)&&o.every(r=>m[r]?m[r](t):t.key===r),shift:(e,...o)=>t=>m.shift(t)&&o.every(r=>m[r]?m[r](t):t.key===r),alt:(e,...o)=>t=>m.alt(t)&&o.every(r=>m[r]?m[r](t):t.key===r),meta:(e,...o)=>t=>m.meta(t)&&o.every(r=>m[r]?m[r](t):t.key===r),arrow:()=>m.arrow,enter:()=>m.enter,esc:()=>m.esc,tab:()=>m.tab,space:()=>m.space,delete:()=>m.delete,digit:()=>m.digit,letter:()=>m.letter,char:()=>m.char},m={ctrl:e=>e.ctrlKey||e.key==="Control"||e.key==="Ctrl",shift:e=>e.shiftKey||e.key==="Shift",alt:e=>e.altKey||e.key==="Alt",meta:e=>e.metaKey||e.key==="Meta"||e.key==="Command",arrow:e=>e.key.startsWith("Arrow"),enter:e=>e.key==="Enter",esc:e=>e.key.startsWith("Esc"),tab:e=>e.key==="Tab",space:e=>e.key==="\xA0"||e.key==="Space"||e.key===" ",delete:e=>e.key==="Delete"||e.key==="Backspace",digit:e=>/^\d$/.test(e.key),letter:e=>/^\p{L}$/gu.test(e.key),char:e=>/^\S$/.test(e.key)},D=(e,o,t)=>{t==null||t===!1?e.removeAttribute(o):e.setAttribute(o,t===!0?"":typeof t=="number"||typeof t=="string"?t:"")},se=(e,o)=>{let t,r,s=i=>{t=!0,setTimeout(()=>{if(t=!1,r)return r=!1,s(i),e(i)},o)};return i=>t?r=!0:(s(i),e(i))},le=(e,o)=>{let t;return r=>{clearTimeout(t),t=setTimeout(()=>{t=null,e(r)},o)}},ce=e=>e.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,o=>"-"+o.toLowerCase());u.value=(e,[o,t],r)=>{let s=e.type==="text"||e.type===""?n=>e.setAttribute("value",e.value=n??""):e.tagName==="TEXTAREA"||e.type==="text"||e.type===""?(n,c,a)=>(c=e.selectionStart,a=e.selectionEnd,e.setAttribute("value",e.value=n??""),c&&e.setSelectionRange(c,a)):e.type==="checkbox"?n=>(e.checked=n,D(e,"checked",n)):e.type==="select-one"?n=>{for(let c in e.options)c.removeAttribute("selected");e.value=n,e.selectedOptions[0]?.setAttribute("selected","")}:n=>e.value=n,i=e.type==="checkbox"?n=>t(r,e.checked):n=>t(r,e.value);return e.addEventListener("input",i),e.addEventListener("change",i),p(()=>s(o(r)))};u.value.parse=e=>{let o=[W(e)];try{o.push(W(`${e}=arguments[1];`))}catch{}return o};u.fx=(e,o,t)=>p(()=>o(t));d.use(F);d.use({compile:e=>d.constructor(`with (arguments[0]) { return ${e} };`)});var J=d;module.exports=J;typeof document<"u"&&document?.currentScript?.hasAttribute("init")&&J(document.documentElement);
;if (typeof module.exports == "object" && typeof exports == "object") {
  var __cp = (to, from, except, desc) => {
    if ((from && typeof from === "object") || typeof from === "function") {
      for (let key of Object.getOwnPropertyNames(from)) {
        if (!Object.prototype.hasOwnProperty.call(to, key) && key !== except)
        Object.defineProperty(to, key, {
          get: () => from[key],
          enumerable: !(desc = Object.getOwnPropertyDescriptor(from, key)) || desc.enumerable,
        });
      }
    }
    return to;
  };
  module.exports = __cp(module.exports, exports);
}
return module.exports;
}))
