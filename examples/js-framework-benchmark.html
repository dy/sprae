<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>sprae</title>
  <link href="./css/bootstrap.min.css" rel="stylesheet">
  <link href="./css/main.css" rel="stylesheet">
</head>

<body>
  <div id="main">
    <div class="container">
      <div class="jumbotron">
        <div class="row">
          <div class="col-md-6">
            <h1>sprae</h1>
          </div>
          <div class="col-md-6">
            <div class="row">
              <div class="col-sm-6 smallpad">
                <button @click="run()" type="button" class="btn btn-primary btn-block" id="run">Create 1,000
                  rows</button>
              </div>
              <div class="col-sm-6 smallpad">
                <button @click="runLots()" type="button" class="btn btn-primary btn-block" id="runlots">Create 10,000
                  rows</button>
              </div>
              <div class="col-sm-6 smallpad">
                <button @click="add()" type="button" class="btn btn-primary btn-block" id="add">Append 1,000
                  rows</button>
              </div>
              <div class="col-sm-6 smallpad">
                <button @click="update()" type="button" class="btn btn-primary btn-block" id="update">Update every 10th
                  row</button>
              </div>
              <div class="col-sm-6 smallpad">
                <button @click="clear()" type="button" class="btn btn-primary btn-block" id="clear">Clear</button>
              </div>
              <div class="col-sm-6 smallpad">
                <button @click="swap()" type="button" class="btn btn-primary btn-block" id="swaprows">Swap Rows</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <table class="table table-hover table-striped test-data">
        <tr :each="item in rows" :class="selected && item.id == selected.id ? 'danger' : ''">
          <td class="col-md-1" :text="item.id"></td>
          <td class="col-md-4">
            <a role="select" @click="select(item)" :text="item.label"></a>
          </td>
          <td class="col-md-1">
            <a>
              <span role="delete" @click="remove(item)" class="glyphicon glyphicon-remove" aria-hidden="true"></span>
            </a>
          </td>
          <td class="col-md-6"></td>
        </tr>
      </table>
    </div>
    <span class="preloadicon glyphicon glyphicon-remove" aria-hidden="true"></span>
  </div>

  <script type="module">
    import sprae, { signal, batch } from '../sprae.js'

    const adjectives = ['pretty', 'large', 'big', 'small', 'tall', 'short', 'long', 'handsome', 'plain', 'quaint', 'clean', 'elegant', 'easy', 'angry', 'crazy', 'helpful', 'mushy', 'odd', 'unsightly', 'adorable', 'important', 'inexpensive', 'cheap', 'expensive', 'fancy']
    const colours = ['red', 'yellow', 'blue', 'green', 'pink', 'brown', 'purple', 'brown', 'white', 'black', 'orange']
    const nouns = ['table', 'chair', 'house', 'bbq', 'desk', 'car', 'pony', 'cookie', 'sandwich', 'burger', 'pizza', 'mouse', 'keyboard']

    let nextId = 1
    function buildData(count) {
      const data = []

      for (let i = 0; i < count; i++) {
        data.push({
          id: nextId++,
          label: `${adjectives[_random(adjectives.length)]} ${colours[_random(colours.length)]} ${nouns[_random(nouns.length)]}`,
        })
      }

      return data
    }

    function _random(max) {
      return Math.round(Math.random() * 1000) % max
    }

    const state = {
      rows: signal(buildData(3)),
      selected: signal(null),

      remove(item) {
        const rows = this.rows.value
        const index = rows.findIndex(x => (x.id == item.id))
        rows.splice(index, 1)
        batch(() => (this.rows.value = null, this.rows.value = rows))
      },

      select(item) {
        this.selected.value = item
      },

      run() {
        this.rows.value = buildData(1000)
        this.selected.value = null
      },

      add() {
        this.rows.value = this.rows.value.concat(buildData(1000))
        this.selected.value = null
      },

      update() {
        const rows = this.rows.value
        for (let i = 0; i < rows.length; i += 10) {
          rows[i].label += ' !!!'
        }
        this.selected.value = null
        batch(() => (this.rows.value = null, this.rows.value = rows))
      },

      runLots() {
        this.rows.value = buildData(10000)
        this.selected.value = null
      },

      clear() {
        this.rows.value = []
        this.selected.value = null
      },

      swap() {
        const rows = this.rows.value
        if (rows.length > 998) {
          const a = rows[1]
          rows[1] = rows[998]
          rows[998] = a
        }
        batch(() => (this.rows.value = null, this.rows.value = rows))
      }
    }

    sprae(document.getElementById('main'), state)
  </script>
</body>

</html>
